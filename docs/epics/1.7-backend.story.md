# Story 1.7-Backend: Implement User Management APIs

## Status
Draft

## Story
**As a** Backend Developer,
**I want** user management CRUD APIs implemented,
**so that** owners can manage student and staff accounts.

## Acceptance Criteria
1. GET `/owner/users` - List all users with pagination
2. GET `/owner/users/{userId}` - Get user details
3. POST `/owner/users` - Create new user account
4. PUT `/owner/users/{userId}` - Update user profile
5. DELETE `/owner/users/{userId}` - Soft delete user
6. Owner can only manage users in their hall
7. PostgreSQL MCP validation completed

## Tasks / Subtasks
- [ ] Create UserManagementController with all CRUD endpoints
- [ ] Create UserManagementService
- [ ] Implement pagination with Spring Data PageRequest
- [ ] Add filtering (by role, status, search term)
- [ ] Implement soft delete (set deleted_at timestamp)
- [ ] Verify owner can only access users in their hall
- [ ] Create DTOs (UserListResponse, UserDetailResponse, CreateUserRequest)
- [ ] Add validation (email unique, required fields)
- [ ] Create comprehensive tests
- [ ] Validate with PostgreSQL MCP

## Dev Notes

### API Specifications

**GET `/owner/users`** (List with pagination)
```
GET /owner/users?page=0&size=20&role=STUDENT&search=john
```
Response: Page<UserSummaryDTO>

**GET `/owner/users/{userId}`** (Get details)
Response: UserDetailDTO with booking history

**POST `/owner/users`** (Create)
Request: CreateUserRequest (email, password, firstName, lastName, role)
Response: 201 Created with user ID

**PUT `/owner/users/{userId}`** (Update)
Request: UpdateUserRequest (firstName, lastName, etc.)
Response: 200 OK with updated user

**DELETE `/owner/users/{userId}`** (Soft delete)
Response: 204 No Content

### Soft Delete Implementation
```java
@SQLDelete(sql = "UPDATE users SET deleted_at = CURRENT_TIMESTAMP WHERE id = ?")
@Where(clause = "deleted_at IS NULL")
@Entity
public class User {
    private LocalDateTime deletedAt;
}
```

### Pagination & Filtering
```java
public Page<UserSummaryDTO> listUsers(Long ownerId, Pageable pageable, String role, String search) {
    return userRepository.findByOwnerAndFilters(ownerId, role, search, pageable);
}
```

### File Locations
- Controller: `controller/UserManagementController.java`
- Service: `service/UserManagementService.java`
- Repository: Update `UserRepository` with custom queries

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-10 | 1.0 | User management APIs backend story | Bob (Scrum Master) |
