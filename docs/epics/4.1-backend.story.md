# Story 4.1-Backend: Implement Announcement Management APIs

## Status
Draft

## Story
**As a** Backend Developer,
**I want** announcement management APIs implemented,
**so that** owners can create and manage announcements for their study halls.

## Acceptance Criteria
1. POST `/owner/announcements` - Create announcement
2. GET `/owner/announcements/{hallId}` - List hall announcements
3. PUT `/owner/announcements/{id}` - Update announcement
4. DELETE `/owner/announcements/{id}` - Delete announcement
5. GET `/student/announcements` - Get announcements for student's enrolled halls
6. Owner can only manage their own hall announcements
7. PostgreSQL MCP validation

## Tasks / Subtasks
- [ ] Create AnnouncementController (owner and student endpoints)
- [ ] Create AnnouncementService
- [ ] Create Announcement entity (hallId, title, content, priority, publishedAt)
- [ ] Implement CRUD operations
- [ ] Add pagination for announcement lists
- [ ] Implement filtering (by priority, date range)
- [ ] Verify owner authorization (hall ownership)
- [ ] Create DTOs (AnnouncementRequest, AnnouncementResponse)
- [ ] Create comprehensive tests
- [ ] Validate with PostgreSQL MCP

## Dev Notes

### Announcement Entity
```java
@Entity
@Table(name = "announcements")
@Data
@Builder
public class Announcement {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne
    @JoinColumn(name = "hall_id", nullable = false)
    private StudyHall hall;

    @Column(nullable = false)
    private String title;

    @Column(columnDefinition = "TEXT")
    private String content;

    @Enumerated(EnumType.STRING)
    private Priority priority; // HIGH, MEDIUM, LOW

    @Column(name = "published_at")
    private LocalDateTime publishedAt;

    @Column(name = "created_at")
    private LocalDateTime createdAt;
}
```

### Service Implementation
```java
@Service
@RequiredArgsConstructor
public class AnnouncementService {

    private final AnnouncementRepository announcementRepository;

    public AnnouncementResponse createAnnouncement(CreateAnnouncementRequest request, Long ownerId) {
        // Verify hall ownership
        verifyHallOwnership(request.getHallId(), ownerId);

        Announcement announcement = Announcement.builder()
            .hall(hallRepository.getReferenceById(request.getHallId()))
            .title(request.getTitle())
            .content(request.getContent())
            .priority(request.getPriority())
            .publishedAt(LocalDateTime.now())
            .build();

        announcementRepository.save(announcement);
        return toResponse(announcement);
    }

    public List<AnnouncementResponse> getStudentAnnouncements(Long userId) {
        // Find halls where student has active subscription/booking
        List<Long> enrolledHallIds = findEnrolledHalls(userId);

        return announcementRepository
            .findByHallIdInOrderByPublishedAtDesc(enrolledHallIds);
    }
}
```

### File Locations
- Controller: `controller/AnnouncementController.java`
- Service: `service/AnnouncementService.java`
- Entity: `model/Announcement.java` (new)
- Repository: `repository/AnnouncementRepository.java` (new)

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-10 | 1.0 | Announcement management APIs | Bob (Scrum Master) |
