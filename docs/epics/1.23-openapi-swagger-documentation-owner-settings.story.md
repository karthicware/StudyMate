# Story 1.23: OpenAPI/Swagger Documentation for Owner Settings API

## Story Metadata

| Field | Value |
|-------|-------|
| **Story ID** | 1.23 |
| **Title** | OpenAPI/Swagger Documentation for Owner Settings API |
| **Epic** | Epic-1 - Owner Dashboard & Analytics |
| **Feature** | Feature 1.5 - Owner Portal Infrastructure |
| **Priority** | Low |
| **Story Points** | 2 |
| **Status** | Ready for development |
| **Dependencies** | Story 1.21 (Owner Settings API Implementation) |
| **Blocks** | None |

---

## User Story

**As an** API Consumer (Frontend Developer or External Integration),
**I need** comprehensive OpenAPI/Swagger documentation for the Owner Settings API endpoints
**so that** I can understand how to use the API correctly without referring to source code or asking the backend team.

---

## Acceptance Criteria

### AC1: Configure Springdoc OpenAPI
- [ ] Add `springdoc-openapi-starter-webmvc-ui` dependency to pom.xml
- [ ] Configure Springdoc properties in application.yml
- [ ] Swagger UI accessible at `/swagger-ui.html` or `/swagger-ui/index.html`
- [ ] OpenAPI JSON spec accessible at `/v3/api-docs`
- [ ] API documentation grouped logically (e.g., "Owner Settings Management")

### AC2: Document OwnerSettingsController Endpoints
- [ ] Add `@Tag` annotation to controller class with description
- [ ] Add `@Operation` annotations to both GET and PUT methods
- [ ] Include summary and detailed description for each endpoint
- [ ] Document authentication requirements (@SecurityRequirement)
- [ ] Document authorization (ROLE_OWNER required)

### AC3: Document Request/Response Models
- [ ] Add `@Schema` annotations to `OwnerSettingsDTO`
- [ ] Add `@Schema` annotations to `UpdateSettingsRequest`
- [ ] Include field descriptions, examples, and constraints
- [ ] Document enum values (language, defaultView, profileVisibility)
- [ ] Mark required vs optional fields clearly

### AC4: Document Response Status Codes
- [ ] Document 200 OK responses with examples
- [ ] Document 400 Bad Request with validation error examples
- [ ] Document 401 Unauthorized (missing/invalid JWT)
- [ ] Document 403 Forbidden (wrong role)
- [ ] Document 500 Internal Server Error
- [ ] Use `@ApiResponse` annotations for each status code

### AC5: Provide Request/Response Examples
- [ ] Add example request bodies for PUT endpoint
- [ ] Add example response bodies for both endpoints
- [ ] Include partial update example (only some fields)
- [ ] Include full update example (all fields)
- [ ] Include default settings response example

### AC6: API Documentation Accessibility
- [ ] Swagger UI is visually clear and navigable
- [ ] All endpoints are testable via "Try it out" feature
- [ ] Examples are copy-paste ready
- [ ] Security scheme (JWT Bearer) configured in Swagger UI
- [ ] Documentation includes API version information

---

## Tasks / Subtasks

- [ ] Task 1: Add Springdoc OpenAPI dependency (AC: 1)
  - [ ] Add `springdoc-openapi-starter-webmvc-ui` to pom.xml
  - [ ] Verify compatible version with Spring Boot 3.5.6 via context7 MCP
  - [ ] Run `./mvnw clean install` to download dependencies
  - [ ] Verify no dependency conflicts

- [ ] Task 2: Configure OpenAPI settings (AC: 1)
  - [ ] Add configuration to `application.yml`:
    - API title: "StudyMate API"
    - API version: "v1.0"
    - API description: "RESTful API for StudyMate study hall management system"
    - Contact info (optional)
    - License info (optional)
  - [ ] Configure Swagger UI path if needed
  - [ ] Configure API docs path if needed
  - [ ] Set up API grouping/tags

- [ ] Task 3: Create OpenAPI configuration class (AC: 1, 6)
  - [ ] Create `OpenApiConfig.java` in `com.studymate.backend.config` package
  - [ ] Configure `@OpenAPIDefinition` annotation
  - [ ] Define security scheme (JWT Bearer token)
  - [ ] Add `@SecurityScheme` for JWT authentication
  - [ ] Set up custom API information (title, version, description)

- [ ] Task 4: Document OwnerSettingsController class (AC: 2)
  - [ ] Add `@Tag(name = "Owner Settings", description = "APIs for managing owner notification and system preferences")`
  - [ ] Import OpenAPI annotations (`io.swagger.v3.oas.annotations.*`)
  - [ ] Verify tag appears in Swagger UI

- [ ] Task 5: Document GET /api/owner/settings endpoint (AC: 2, 4)
  - [ ] Add `@Operation` annotation with:
    - summary: "Get owner settings"
    - description: "Retrieves settings for the authenticated owner. Creates default settings if none exist."
  - [ ] Add `@SecurityRequirement(name = "bearerAuth")`
  - [ ] Add `@ApiResponse` annotations:
    - 200: Success with OwnerSettingsDTO
    - 401: Unauthorized
    - 403: Forbidden
    - 500: Internal server error
  - [ ] Include response examples using `@Content` and `@Schema`

- [ ] Task 6: Document PUT /api/owner/settings endpoint (AC: 2, 4, 5)
  - [ ] Add `@Operation` annotation with:
    - summary: "Update owner settings"
    - description: "Updates owner settings with partial or full payload. Only provided fields will be updated."
  - [ ] Add `@SecurityRequirement(name = "bearerAuth")`
  - [ ] Add `@Parameter` annotation for request body with examples
  - [ ] Add `@ApiResponse` annotations:
    - 200: Success with updated OwnerSettingsDTO
    - 400: Validation error with error response example
    - 401: Unauthorized
    - 403: Forbidden
    - 500: Internal server error
  - [ ] Include request/response examples

- [ ] Task 7: Document OwnerSettingsDTO (AC: 3)
  - [ ] Add `@Schema` annotation to class with description
  - [ ] Add `@Schema` to each field with:
    - description: Clear explanation of field purpose
    - example: Sample value
    - required: true/false
    - allowableValues: For enum fields
  - [ ] Document boolean notification fields
  - [ ] Document string fields with enum constraints

- [ ] Task 8: Document UpdateSettingsRequest (AC: 3, 5)
  - [ ] Add `@Schema` annotation to class
  - [ ] Add `@Schema` to each field marking all as optional
  - [ ] Include examples for partial updates
  - [ ] Document validation patterns for enum fields
  - [ ] Explain partial update behavior in class description

- [ ] Task 9: Add comprehensive examples (AC: 5)
  - [ ] Create example: GET response with default settings
  - [ ] Create example: PUT partial update (email + language only)
  - [ ] Create example: PUT full update (all fields)
  - [ ] Create example: 400 validation error response
  - [ ] Embed examples in annotations using `@ExampleObject`

- [ ] Task 10: Test Swagger UI accessibility (AC: 6)
  - [ ] Start application: `./mvnw spring-boot:run`
  - [ ] Access Swagger UI at http://localhost:8080/swagger-ui.html
  - [ ] Verify all Owner Settings endpoints visible
  - [ ] Test "Try it out" functionality (use mock JWT if available)
  - [ ] Verify examples are displayed correctly
  - [ ] Check that security scheme (JWT) is configurable
  - [ ] Take screenshot of Swagger UI for documentation

- [ ] Task 11: Document OpenAPI setup in README (AC: 6)
  - [ ] Add section to backend README about API documentation
  - [ ] Include Swagger UI URL
  - [ ] Include OpenAPI JSON URL
  - [ ] Explain how to authenticate (JWT token) in Swagger UI
  - [ ] Provide sample JWT token format for testing (if applicable)

---

## Dev Notes

### Previous Story Insights

**From Story 1.21** (Owner Settings API Implementation):
- Two endpoints implemented:
  - GET /api/owner/settings
  - PUT /api/owner/settings
- Uses JWT authentication (ROLE_OWNER required)
- Supports partial updates (only non-null fields updated)
- Returns OwnerSettingsDTO response
- Accepts UpdateSettingsRequest with Bean Validation
- Files to document:
  - `studymate-backend/src/main/java/com/studymate/backend/controller/OwnerSettingsController.java`
  - `studymate-backend/src/main/java/com/studymate/backend/dto/OwnerSettingsDTO.java`
  - `studymate-backend/src/main/java/com/studymate/backend/dto/UpdateSettingsRequest.java`

**QA Gate Feedback:**
- Non-blocking recommendation (priority: low)
- Reference: OwnerSettingsController.java
- Note: "Add @Operation, @ApiResponse annotations for API documentation generation."

### Architecture Overview

[Source: docs/architecture/tech-stack.md#backend-stack]
- **Backend**: Spring Boot 3.5.6 with Java 17
- **API Documentation**: Springdoc OpenAPI for API documentation
- **REST APIs**: Following RESTful principles
- **Security**: JWT/OAuth 2.0 for authentication

### Springdoc OpenAPI Integration

[Source: docs/architecture/coding-standards.md#java-spring-boot-standards]
- Use Springdoc OpenAPI 2.x for Spring Boot 3.x
- Swagger UI provides interactive API documentation
- OpenAPI 3.0 specification format
- Annotations from `io.swagger.v3.oas.annotations` package

### Required Maven Dependency

```xml
<dependency>
    <groupId>org.springdoc</groupId>
    <artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>
    <version>2.3.0</version> <!-- Verify latest compatible version via context7 -->
</dependency>
```

### OpenAPI Configuration Example

**File:** `OpenApiConfig.java`

```java
package com.studymate.backend.config;

import io.swagger.v3.oas.annotations.OpenAPIDefinition;
import io.swagger.v3.oas.annotations.enums.SecuritySchemeType;
import io.swagger.v3.oas.annotations.info.Contact;
import io.swagger.v3.oas.annotations.info.Info;
import io.swagger.v3.oas.annotations.security.SecurityScheme;
import org.springframework.context.annotation.Configuration;

@Configuration
@OpenAPIDefinition(
    info = @Info(
        title = "StudyMate API",
        version = "v1.0",
        description = "RESTful API for StudyMate study hall management system",
        contact = @Contact(
            name = "StudyMate Development Team",
            email = "dev@studymate.com"
        )
    )
)
@SecurityScheme(
    name = "bearerAuth",
    type = SecuritySchemeType.HTTP,
    scheme = "bearer",
    bearerFormat = "JWT",
    description = "JWT authentication token"
)
public class OpenApiConfig {
    // Configuration class - no methods needed
}
```

### Controller Documentation Example

```java
@RestController
@RequestMapping("/api/owner/settings")
@RequiredArgsConstructor
@Tag(name = "Owner Settings", description = "APIs for managing owner notification and system preferences")
public class OwnerSettingsController {

    private final OwnerSettingsService settingsService;

    @Operation(
        summary = "Get owner settings",
        description = "Retrieves settings for the authenticated owner. Creates default settings if none exist.",
        security = @SecurityRequirement(name = "bearerAuth")
    )
    @ApiResponses(value = {
        @ApiResponse(
            responseCode = "200",
            description = "Successfully retrieved owner settings",
            content = @Content(
                mediaType = "application/json",
                schema = @Schema(implementation = OwnerSettingsDTO.class),
                examples = @ExampleObject(
                    name = "Default Settings",
                    value = "{\"emailNotifications\":true,\"smsNotifications\":false,...}"
                )
            )
        ),
        @ApiResponse(
            responseCode = "401",
            description = "Unauthorized - Invalid or missing JWT token"
        ),
        @ApiResponse(
            responseCode = "403",
            description = "Forbidden - User does not have OWNER role"
        )
    })
    @GetMapping
    public ResponseEntity<OwnerSettingsDTO> getSettings(Authentication authentication) {
        // Implementation...
    }
}
```

### DTO Documentation Example

```java
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
@Schema(description = "Owner settings data transfer object containing notification and system preferences")
public class OwnerSettingsDTO {

    @Schema(
        description = "Enable or disable email notifications",
        example = "true",
        required = true
    )
    private Boolean emailNotifications;

    @Schema(
        description = "Enable or disable SMS notifications",
        example = "false",
        required = true
    )
    private Boolean smsNotifications;

    @Schema(
        description = "Preferred language for the owner portal",
        example = "en",
        allowableValues = {"en", "es", "fr"},
        required = true
    )
    private String language;

    // ... other fields
}
```

### File Locations

**New Files:**
- `studymate-backend/src/main/java/com/studymate/backend/config/OpenApiConfig.java`

**Files to Modify:**
- `studymate-backend/pom.xml` (add dependency)
- `studymate-backend/src/main/resources/application.yml` (add Springdoc config)
- `studymate-backend/src/main/java/com/studymate/backend/controller/OwnerSettingsController.java`
- `studymate-backend/src/main/java/com/studymate/backend/dto/OwnerSettingsDTO.java`
- `studymate-backend/src/main/java/com/studymate/backend/dto/UpdateSettingsRequest.java`
- `studymate-backend/README.md` (add API documentation section)

### application.yml Configuration

```yaml
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
    operationsSorter: method
    tagsSorter: alpha
    tryItOutEnabled: true
  show-actuator: false
```

### Testing OpenAPI Documentation

1. **Start Application**: `./mvnw spring-boot:run`
2. **Access Swagger UI**: http://localhost:8080/swagger-ui.html
3. **Access OpenAPI JSON**: http://localhost:8080/v3/api-docs
4. **Test Endpoints**: Use "Try it out" feature in Swagger UI
5. **Verify JWT Authentication**: Add JWT token in "Authorize" button

### context7 MCP Integration (MANDATORY)

[Source: docs/architecture/tech-stack.md#development-tools]
- **Pre-Implementation**: Consult context7 for Springdoc OpenAPI best practices
- **Required Queries**:
  - `"use context7 - Springdoc OpenAPI 2.3.0 configuration Spring Boot 3.5.6"`
  - `"use context7 - OpenAPI 3.0 annotations examples"`
  - `"use context7 - Swagger UI JWT authentication configuration"`

### OpenAPI Annotation Imports

```java
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.Parameter;
import io.swagger.v3.oas.annotations.media.Content;
import io.swagger.v3.oas.annotations.media.ExampleObject;
import io.swagger.v3.oas.annotations.media.Schema;
import io.swagger.v3.oas.annotations.responses.ApiResponse;
import io.swagger.v3.oas.annotations.responses.ApiResponses;
import io.swagger.v3.oas.annotations.security.SecurityRequirement;
import io.swagger.v3.oas.annotations.tags.Tag;
```

### Documentation Best Practices

1. **Be Descriptive**: Write clear summaries and descriptions
2. **Provide Examples**: Include realistic request/response examples
3. **Document Errors**: Show all possible error responses with examples
4. **Security First**: Clearly indicate authentication requirements
5. **Keep Updated**: Update documentation when API changes
6. **Test It**: Verify "Try it out" functionality works
7. **Version APIs**: Include version information in documentation

---

## Definition of Done

- [ ] Springdoc OpenAPI dependency added and configured
- [ ] OpenApiConfig class created with JWT security scheme
- [ ] OwnerSettingsController fully documented with annotations
- [ ] OwnerSettingsDTO documented with field descriptions and examples
- [ ] UpdateSettingsRequest documented with validation constraints
- [ ] Swagger UI accessible and functional
- [ ] All endpoints testable via "Try it out"
- [ ] Request/response examples provided
- [ ] JWT authentication scheme configured
- [ ] README updated with API documentation instructions
- [ ] Screenshot of Swagger UI included in documentation
- [ ] Code reviewed and approved

---

## References

- **Story 1.21**: [Owner Settings API Implementation](./1.21-owner-settings-api-implementation.story.md)
- **QA Gate**: [Quality Gate for Story 1.21](../qa/gates/1.21-owner-settings-api-implementation.yml)
- **Context7 MCP**: `"use context7 - Springdoc OpenAPI Spring Boot 3.5.6"`
- **Coding Standards**: [Java/Spring Boot Rules](../guidelines/coding-standard-guidelines/java-spring-rules.md)
- **Springdoc Docs**: https://springdoc.org/ (reference via context7)

---

## Estimated Effort: ~8 hours (2 SP)

---

**Status:** Draft
**Assigned To:** Development Agent (James)
**Depends On:** Story 1.21 (completed)

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-13 | 1.0 | Story created for OpenAPI/Swagger Documentation | Bob (Scrum Master) |
