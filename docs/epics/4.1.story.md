# Story 4.1: Announcement Creation Interface (Frontend)

## Story Metadata

| Field | Value |
|-------|-------|
| **Story ID** | 4.1 |
| **Story Name** | Announcement Creation Interface (Frontend) |
| **Epic** | Epic 4: Communication & Announcements |
| **Feature** | Feature 6.1: Announcements |
| **Story Type** | Frontend Development (Angular Component) |
| **Priority** | Medium |
| **Status** | Draft |
| **Estimated Story Points** | 5 SP |
| **Sprint** | TBD |
| **Assigned To** | Unassigned |
| **Created Date** | 2025-10-14 |
| **Updated Date** | 2025-10-14 |

---

## User Story

**As an** Owner,
**I want** to compose and create announcements through an intuitive interface
**so that** I can communicate important notices to students in my study halls.

---

## Story Description

This story implements the frontend announcement creation interface for study hall owners. The component provides a form-based UI where owners can compose announcement titles and messages, specify target audiences, and set optional expiration dates. The interface follows the design system standards (Section 9) and integrates with the backend API for announcement creation.

**Context**:
- This is part of Epic 4's communication system between owners and students
- Backend Story 4.1-backend must be completed first to provide the API endpoints
- This is the first frontend story in the announcement feature set
- The interface will be accessed from the Owner Portal navigation

**Dependencies**:
- Epic 0.1 (Authentication) - Required for owner JWT tokens
- Story 4.1-backend (Backend APIs) - MUST be completed first
- Owner Portal Infrastructure (Stories 1.15, 1.16, 1.17) - Required for navigation and layout

---

## Acceptance Criteria

### AC1: Announcement Creation Form Component
**Given** an authenticated owner accesses the announcement creation page
**When** the page loads
**Then** the system displays a form with the following fields:
- Title field (text input, max 255 characters)
- Message field (textarea with rich text formatting, required)
- Target Audience dropdown (options: "All Students", "Active Bookings", "Past Students")
- Expiration Date picker (optional)
- Hall selection dropdown (populated with owner's study halls)
- Submit button ("Publish Announcement")
- Cancel button (navigate back)

**Validation Requirements**:
- Title: Required, max 255 characters
- Message: Required, min 10 characters
- Hall selection: Required
- Expiration date: Optional, must be future date if provided
- Real-time validation with error messages below fields

**Testing**:
- [ ] Component renders with all required form fields
- [ ] Validation triggers on blur and submit
- [ ] Error messages display correctly for invalid inputs
- [ ] Cancel button navigates back to previous page
- [ ] Zero browser console errors

[Source: Epic 4 Feature 6.1, Section 3.2]

---

### AC2: Form Submission and API Integration
**Given** an owner has filled out the announcement form with valid data
**When** the owner clicks "Publish Announcement"
**Then** the system:
- Disables the submit button and shows loading state
- Sends POST request to `/owner/announcements` with announcement data
- On success: Displays success toast notification, navigates to announcement list
- On error: Displays error toast notification, re-enables form

**Request Payload Format**:
```typescript
{
  hallId: string;
  title: string;
  message: string;
  targetAudience: 'all' | 'active_bookings' | 'past_students';
  expiresAt?: string; // ISO 8601 format
}
```

**Response Handling**:
- Success (201): `{ id: string, message: string }`
- Error (400/401/500): `{ error: string, message: string }`

**Testing**:
- [ ] POST request sent with correct payload structure
- [ ] Authorization header includes JWT token
- [ ] Success response triggers navigation and toast
- [ ] Error response displays user-friendly message
- [ ] Loading state prevents duplicate submissions
- [ ] Network failures handled gracefully

[Source: Epic 4 API Endpoints Table]

---

### AC3: Hall Selection Dropdown Population
**Given** an owner opens the announcement creation form
**When** the component initializes
**Then** the system:
- Fetches the owner's study halls from the backend
- Populates the hall dropdown with hall names
- Pre-selects the first hall by default (if multiple halls exist)
- Displays loading state while fetching halls

**Hall Fetch Logic**:
- API: GET `/owner/halls`
- Filter halls where `status = 'active'`
- Display format: `{hallName}` (e.g., "Downtown Study Center")

**Error Handling**:
- If no halls available: Display message "No active study halls found. Please create a hall first."
- If API fails: Display error toast and retry option

**Testing**:
- [ ] Dropdown populates with owner's active halls
- [ ] First hall selected by default
- [ ] Loading state shown during fetch
- [ ] Error state handled with user guidance
- [ ] Empty state displays helpful message

[Source: Epic 1 Multi-tenant Context, Epic 4 Feature 6.1]

---

### AC4: Rich Text Editor Integration
**Given** an owner is composing an announcement message
**When** the owner types in the message field
**Then** the system provides:
- Basic rich text formatting options (bold, italic, underline)
- Bullet and numbered lists
- Undo/redo functionality
- Character count display
- Preview mode toggle (optional enhancement)

**Rich Text Editor Requirements**:
- Use Angular-compatible rich text library (e.g., CKEditor, Quill, or native contenteditable)
- Sanitize HTML output to prevent XSS attacks
- Store formatted message as HTML string
- Display character/word count below editor

**Testing**:
- [ ] Rich text formatting applies correctly
- [ ] HTML output is sanitized
- [ ] Character count updates in real-time
- [ ] Copy-paste from external sources works
- [ ] Editor works on mobile devices

[Source: Epic 4 Feature 6.1 AC1, Epic 4 UI/UX Considerations]

---

### AC5: Design System Compliance
**Given** the announcement creation interface is implemented
**When** the page is rendered
**Then** the component follows design system standards:

**Visual Design** (Section 9):
- Background: White (`bg-white`)
- Border: Subtle gray border (`border-gray-200`)
- Typography: Inter font family, proper weight scale
- Spacing: 8-point grid system (`p-4`, `gap-4`)
- Shadows: `shadow-card` for elevated surfaces
- Border Radius: `rounded-lg` for inputs and buttons

**Form Elements**:
- Input fields: `border-gray-300`, `focus:border-blue-500`, `rounded-md`
- Labels: `text-sm font-medium text-gray-700`
- Error messages: `text-sm text-red-600`
- Buttons: Primary variant for submit, Ghost variant for cancel

**Responsive Design**:
- Mobile: Single column layout, full-width inputs
- Tablet: Single column with centered form (max-width 768px)
- Desktop: Single column with centered form (max-width 640px)

**Accessibility**:
- All inputs have associated labels
- Error messages linked with `aria-describedby`
- Keyboard navigation works throughout form
- Focus indicators visible on all interactive elements

**Testing**:
- [ ] Visual design matches Section 9 specifications
- [ ] Responsive breakpoints work correctly
- [ ] ARIA attributes present and correct
- [ ] Keyboard navigation functional
- [ ] Color contrast meets WCAG AA standards

[Source: Epic 4 Technical Requirements, Architecture docs/guidelines/airbnb-inspired-design-system/index.md]

---

## Technical Implementation Details

### Component Structure

**Location**: `studymate-frontend/src/app/features/owner/announcements/announcement-create/announcement-create.component.ts`

**Component Pattern**: Smart Component (Container)
- Manages form state with Angular Signals
- Handles API communication
- Manages navigation and side effects

**File Structure**:
```
src/app/features/owner/announcements/
├── announcement-create/
│   ├── announcement-create.component.ts
│   ├── announcement-create.component.html
│   ├── announcement-create.component.scss
│   └── announcement-create.component.spec.ts
├── models/
│   └── announcement.model.ts
└── services/
    └── announcement.service.ts
```

[Source: Architecture docs/architecture/unified-project-structure.md, docs/architecture/frontend-architecture.md]

---

### TypeScript Models

**Create**: `src/app/features/owner/announcements/models/announcement.model.ts`

```typescript
export interface Announcement {
  id: string;
  hallId: string;
  ownerId: string;
  title: string;
  message: string;
  targetAudience: 'all' | 'active_bookings' | 'past_students';
  publishedAt: Date;
  expiresAt?: Date;
  createdAt: Date;
  updatedAt: Date;
}

export interface AnnouncementCreateRequest {
  hallId: string;
  title: string;
  message: string;
  targetAudience: 'all' | 'active_bookings' | 'past_students';
  expiresAt?: string; // ISO 8601 format
}

export interface AnnouncementCreateResponse {
  id: string;
  message: string;
}

export interface AnnouncementFormData {
  hallId: string;
  title: string;
  message: string;
  targetAudience: 'all' | 'active_bookings' | 'past_students';
  expiresAt?: Date;
}
```

**Database Schema Reference** (from data-models.md lines 462-479):
```sql
CREATE TABLE announcements (
    id                  UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    hall_id             UUID NOT NULL REFERENCES study_halls(id) ON DELETE CASCADE,
    owner_id            UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    title               VARCHAR(255) NOT NULL,
    message             TEXT NOT NULL,
    target_audience     VARCHAR(50) DEFAULT 'all',
    published_at        TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expires_at          TIMESTAMP,
    created_at          TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at          TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

[Source: Architecture docs/architecture/data-models.md lines 455-484, Epic 4 API Endpoints]

---

### Angular Service

**Create**: `src/app/features/owner/announcements/services/announcement.service.ts`

```typescript
import { Injectable, inject } from '@angular/core';
import { HttpClient, HttpHeaders } from '@angular/common/http';
import { Observable } from 'rxjs';
import { AnnouncementCreateRequest, AnnouncementCreateResponse } from '../models/announcement.model';

@Injectable({
  providedIn: 'root'
})
export class AnnouncementService {
  private http = inject(HttpClient);
  private apiUrl = '/api/owner/announcements';

  createAnnouncement(request: AnnouncementCreateRequest): Observable<AnnouncementCreateResponse> {
    const headers = new HttpHeaders({
      'Content-Type': 'application/json'
    });

    return this.http.post<AnnouncementCreateResponse>(this.apiUrl, request, { headers });
  }
}
```

**Key Implementation Details**:
- Use `inject()` function for dependency injection (modern Angular 20 pattern)
- HTTP requests automatically include Authorization header via HttpInterceptor
- Service is provided in root for singleton pattern
- All HTTP calls return Observables

[Source: Architecture docs/architecture/frontend-architecture.md lines 90-107, docs/architecture/coding-standards.md lines 223-229]

---

### Component Implementation

**Create**: `src/app/features/owner/announcements/announcement-create/announcement-create.component.ts`

```typescript
import { Component, signal, computed, inject, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormBuilder, FormGroup, ReactiveFormsModule, Validators } from '@angular/forms';
import { Router } from '@angular/router';
import { AnnouncementService } from '../services/announcement.service';
import { ToastService } from '@shared/services/toast.service';
import { StudyHall } from '@core/models/study-hall.model';
import { StudyHallService } from '@core/services/study-hall.service';

@Component({
  selector: 'app-announcement-create',
  standalone: true,
  imports: [CommonModule, ReactiveFormsModule],
  templateUrl: './announcement-create.component.html',
  styleUrls: ['./announcement-create.component.scss']
})
export class AnnouncementCreateComponent implements OnInit {
  private fb = inject(FormBuilder);
  private router = inject(Router);
  private announcementService = inject(AnnouncementService);
  private studyHallService = inject(StudyHallService);
  private toastService = inject(ToastService);

  // Signals for reactive state
  studyHalls = signal<StudyHall[]>([]);
  isLoadingHalls = signal(false);
  isSubmitting = signal(false);

  // Form group
  announcementForm!: FormGroup;

  // Target audience options
  targetAudienceOptions = [
    { value: 'all', label: 'All Students' },
    { value: 'active_bookings', label: 'Active Bookings Only' },
    { value: 'past_students', label: 'Past Students' }
  ];

  ngOnInit(): void {
    this.initializeForm();
    this.loadStudyHalls();
  }

  private initializeForm(): void {
    this.announcementForm = this.fb.group({
      hallId: ['', Validators.required],
      title: ['', [Validators.required, Validators.maxLength(255)]],
      message: ['', [Validators.required, Validators.minLength(10)]],
      targetAudience: ['all', Validators.required],
      expiresAt: [null] // Optional
    });
  }

  private loadStudyHalls(): void {
    this.isLoadingHalls.set(true);

    this.studyHallService.getOwnerHalls().subscribe({
      next: (halls) => {
        const activeHalls = halls.filter(h => h.status === 'active');
        this.studyHalls.set(activeHalls);

        // Pre-select first hall if available
        if (activeHalls.length > 0) {
          this.announcementForm.patchValue({ hallId: activeHalls[0].id });
        }

        this.isLoadingHalls.set(false);
      },
      error: (error) => {
        console.error('Failed to load study halls:', error);
        this.toastService.show('Failed to load study halls. Please try again.', 'error');
        this.isLoadingHalls.set(false);
      }
    });
  }

  onSubmit(): void {
    if (this.announcementForm.invalid) {
      Object.keys(this.announcementForm.controls).forEach(key => {
        this.announcementForm.get(key)?.markAsTouched();
      });
      return;
    }

    this.isSubmitting.set(true);

    const formValue = this.announcementForm.value;
    const request = {
      hallId: formValue.hallId,
      title: formValue.title,
      message: formValue.message,
      targetAudience: formValue.targetAudience,
      expiresAt: formValue.expiresAt ? formValue.expiresAt.toISOString() : undefined
    };

    this.announcementService.createAnnouncement(request).subscribe({
      next: (response) => {
        this.toastService.show('Announcement published successfully!', 'success');
        this.router.navigate(['/owner/announcements']);
      },
      error: (error) => {
        console.error('Failed to create announcement:', error);
        const errorMessage = error.error?.message || 'Failed to publish announcement. Please try again.';
        this.toastService.show(errorMessage, 'error');
        this.isSubmitting.set(false);
      }
    });
  }

  onCancel(): void {
    this.router.navigate(['/owner/announcements']);
  }

  // Helper method for template
  hasError(controlName: string): boolean {
    const control = this.announcementForm.get(controlName);
    return !!(control && control.invalid && control.touched);
  }

  getErrorMessage(controlName: string): string {
    const control = this.announcementForm.get(controlName);

    if (control?.hasError('required')) {
      return `${this.getFieldLabel(controlName)} is required`;
    }
    if (control?.hasError('maxlength')) {
      const maxLength = control.errors?.['maxlength'].requiredLength;
      return `${this.getFieldLabel(controlName)} cannot exceed ${maxLength} characters`;
    }
    if (control?.hasError('minlength')) {
      const minLength = control.errors?.['minlength'].requiredLength;
      return `${this.getFieldLabel(controlName)} must be at least ${minLength} characters`;
    }

    return '';
  }

  private getFieldLabel(controlName: string): string {
    const labels: Record<string, string> = {
      hallId: 'Study hall',
      title: 'Title',
      message: 'Message',
      targetAudience: 'Target audience'
    };
    return labels[controlName] || controlName;
  }
}
```

**Key Implementation Patterns**:
- Standalone component with explicit imports
- `inject()` function for all dependencies
- Signals for reactive state management
- Reactive forms with validation
- Error handling with user-friendly messages
- Loading states for async operations

[Source: Architecture docs/architecture/frontend-architecture.md, docs/architecture/coding-standards.md lines 214-241]

---

### HTML Template

**Create**: `src/app/features/owner/announcements/announcement-create/announcement-create.component.html`

```html
<div class="container mx-auto max-w-2xl px-4 py-8">
  <!-- Page Header -->
  <div class="mb-6">
    <h1 class="text-3xl font-bold text-gray-900">Create Announcement</h1>
    <p class="mt-2 text-sm text-gray-600">
      Compose and publish announcements to communicate with students at your study halls.
    </p>
  </div>

  <!-- Announcement Form Card -->
  <div class="bg-white rounded-lg shadow-card border border-gray-200 p-6">
    <form [formGroup]="announcementForm" (ngSubmit)="onSubmit()">

      <!-- Study Hall Selection -->
      <div class="mb-6">
        <label for="hallId" class="block text-sm font-medium text-gray-700 mb-2">
          Study Hall <span class="text-red-500">*</span>
        </label>

        @if (isLoadingHalls()) {
          <div class="flex items-center text-sm text-gray-500">
            <svg class="animate-spin h-5 w-5 mr-2 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Loading study halls...
          </div>
        } @else if (studyHalls().length === 0) {
          <div class="text-sm text-amber-600 bg-amber-50 border border-amber-200 rounded-md p-3">
            No active study halls found. Please create a hall first.
          </div>
        } @else {
          <select
            id="hallId"
            formControlName="hallId"
            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            [class.border-red-500]="hasError('hallId')"
          >
            <option value="">Select a study hall</option>
            @for (hall of studyHalls(); track hall.id) {
              <option [value]="hall.id">{{ hall.hallName }}</option>
            }
          </select>

          @if (hasError('hallId')) {
            <p class="mt-1 text-sm text-red-600">{{ getErrorMessage('hallId') }}</p>
          }
        }
      </div>

      <!-- Title Field -->
      <div class="mb-6">
        <label for="title" class="block text-sm font-medium text-gray-700 mb-2">
          Announcement Title <span class="text-red-500">*</span>
        </label>
        <input
          type="text"
          id="title"
          formControlName="title"
          placeholder="Enter announcement title"
          class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          [class.border-red-500]="hasError('title')"
        />

        @if (hasError('title')) {
          <p class="mt-1 text-sm text-red-600">{{ getErrorMessage('title') }}</p>
        }

        <p class="mt-1 text-xs text-gray-500">
          {{ announcementForm.get('title')?.value?.length || 0 }} / 255 characters
        </p>
      </div>

      <!-- Message Field -->
      <div class="mb-6">
        <label for="message" class="block text-sm font-medium text-gray-700 mb-2">
          Message <span class="text-red-500">*</span>
        </label>
        <textarea
          id="message"
          formControlName="message"
          rows="6"
          placeholder="Write your announcement message here..."
          class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none"
          [class.border-red-500]="hasError('message')"
        ></textarea>

        @if (hasError('message')) {
          <p class="mt-1 text-sm text-red-600">{{ getErrorMessage('message') }}</p>
        }

        <p class="mt-1 text-xs text-gray-500">
          {{ announcementForm.get('message')?.value?.length || 0 }} characters (minimum 10)
        </p>
      </div>

      <!-- Target Audience -->
      <div class="mb-6">
        <label for="targetAudience" class="block text-sm font-medium text-gray-700 mb-2">
          Target Audience <span class="text-red-500">*</span>
        </label>
        <select
          id="targetAudience"
          formControlName="targetAudience"
          class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        >
          @for (option of targetAudienceOptions; track option.value) {
            <option [value]="option.value">{{ option.label }}</option>
          }
        </select>
      </div>

      <!-- Expiration Date (Optional) -->
      <div class="mb-6">
        <label for="expiresAt" class="block text-sm font-medium text-gray-700 mb-2">
          Expiration Date (Optional)
        </label>
        <input
          type="datetime-local"
          id="expiresAt"
          formControlName="expiresAt"
          class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        />
        <p class="mt-1 text-xs text-gray-500">
          Leave blank if announcement should not expire
        </p>
      </div>

      <!-- Action Buttons -->
      <div class="flex gap-4 justify-end pt-4 border-t border-gray-200">
        <button
          type="button"
          (click)="onCancel()"
          [disabled]="isSubmitting()"
          class="px-6 py-2 text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50"
        >
          Cancel
        </button>

        <button
          type="submit"
          [disabled]="isSubmitting() || studyHalls().length === 0"
          class="px-6 py-2 text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
        >
          @if (isSubmitting()) {
            <svg class="animate-spin h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Publishing...
          } @else {
            Publish Announcement
          }
        </button>
      </div>
    </form>
  </div>
</div>
```

**Key Template Features**:
- Angular 20 control flow syntax (`@if`, `@for`, `@else`)
- Tailwind CSS utility classes following Section 9 design system
- Reactive forms binding with `formControlName`
- Conditional rendering for loading and error states
- Accessibility: labels, ARIA attributes, keyboard navigation
- Loading spinner during submission
- Character counters for title and message fields

[Source: Architecture docs/architecture/frontend-architecture.md lines 185-209, docs/guidelines/airbnb-inspired-design-system/index.md]

---

### Routing Configuration

**Update**: `src/app/features/owner/owner.routes.ts`

Add announcement routes to the owner routing module:

```typescript
import { Routes } from '@angular/router';
import { AuthGuard } from '@core/guards/auth.guard';
import { RoleGuard } from '@core/guards/role.guard';

export const ownerRoutes: Routes = [
  {
    path: '',
    canActivate: [AuthGuard, RoleGuard],
    data: { role: 'owner' },
    children: [
      // ... existing routes ...
      {
        path: 'announcements',
        children: [
          {
            path: '',
            loadComponent: () => import('./announcements/announcement-list/announcement-list.component').then(m => m.AnnouncementListComponent),
            title: 'Announcements | StudyMate'
          },
          {
            path: 'create',
            loadComponent: () => import('./announcements/announcement-create/announcement-create.component').then(m => m.AnnouncementCreateComponent),
            title: 'Create Announcement | StudyMate'
          }
        ]
      }
    ]
  }
];
```

**Key Routing Features**:
- Lazy loading with dynamic imports
- Route guards for authentication and role-based access
- SEO-friendly page titles

[Source: Architecture docs/architecture/frontend-architecture.md lines 222-244, docs/architecture/unified-project-structure.md]

---

## Testing Requirements

### Unit Tests (Jasmine + Karma)

**Create**: `src/app/features/owner/announcements/announcement-create/announcement-create.component.spec.ts`

**Test Coverage Target**: 90%+

**Required Test Cases**:

1. **Component Initialization**:
   - [ ] Component should create successfully
   - [ ] Form should initialize with correct validators
   - [ ] Study halls should be loaded on init
   - [ ] First hall should be pre-selected if available

2. **Form Validation**:
   - [ ] Title field: Required validation
   - [ ] Title field: Max length 255 validation
   - [ ] Message field: Required validation
   - [ ] Message field: Min length 10 validation
   - [ ] Hall selection: Required validation
   - [ ] Target audience: Default to 'all'
   - [ ] Form should be invalid when required fields are empty
   - [ ] Form should be valid when all required fields are filled

3. **API Integration**:
   - [ ] createAnnouncement service method called with correct payload
   - [ ] Success response triggers navigation to announcement list
   - [ ] Success response shows success toast
   - [ ] Error response displays error toast
   - [ ] Error response re-enables form

4. **Loading States**:
   - [ ] isLoadingHalls signal set to true during hall fetch
   - [ ] isLoadingHalls signal set to false after hall fetch completes
   - [ ] isSubmitting signal set to true during submission
   - [ ] Submit button disabled during submission

5. **Error Handling**:
   - [ ] Hall fetch error displays error toast
   - [ ] Empty halls list displays helpful message
   - [ ] Form submission error displays user-friendly message
   - [ ] Network errors handled gracefully

6. **User Interactions**:
   - [ ] Cancel button navigates to announcement list
   - [ ] Error messages display when fields are touched and invalid
   - [ ] Character counter updates as user types

**Example Test Structure**:
```typescript
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { provideHttpClientTesting } from '@angular/common/http/testing';
import { provideHttpClient } from '@angular/common/http';
import { provideRouter } from '@angular/router';
import { AnnouncementCreateComponent } from './announcement-create.component';
import { AnnouncementService } from '../services/announcement.service';
import { StudyHallService } from '@core/services/study-hall.service';
import { ToastService } from '@shared/services/toast.service';
import { of, throwError } from 'rxjs';

describe('AnnouncementCreateComponent', () => {
  let component: AnnouncementCreateComponent;
  let fixture: ComponentFixture<AnnouncementCreateComponent>;
  let announcementService: jasmine.SpyObj<AnnouncementService>;
  let studyHallService: jasmine.SpyObj<StudyHallService>;
  let toastService: jasmine.SpyObj<ToastService>;

  beforeEach(async () => {
    const announcementServiceSpy = jasmine.createSpyObj('AnnouncementService', ['createAnnouncement']);
    const studyHallServiceSpy = jasmine.createSpyObj('StudyHallService', ['getOwnerHalls']);
    const toastServiceSpy = jasmine.createSpyObj('ToastService', ['show']);

    await TestBed.configureTestingModule({
      imports: [AnnouncementCreateComponent],
      providers: [
        provideHttpClient(),
        provideHttpClientTesting(),
        provideRouter([]),
        { provide: AnnouncementService, useValue: announcementServiceSpy },
        { provide: StudyHallService, useValue: studyHallServiceSpy },
        { provide: ToastService, useValue: toastServiceSpy }
      ]
    }).compileComponents();

    announcementService = TestBed.inject(AnnouncementService) as jasmine.SpyObj<AnnouncementService>;
    studyHallService = TestBed.inject(StudyHallService) as jasmine.SpyObj<StudyHallService>;
    toastService = TestBed.inject(ToastService) as jasmine.SpyObj<ToastService>;

    studyHallService.getOwnerHalls.and.returnValue(of([
      { id: 'hall-1', hallName: 'Test Hall', status: 'active' } as any
    ]));

    fixture = TestBed.createComponent(AnnouncementCreateComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });

  it('should load study halls on init', () => {
    expect(studyHallService.getOwnerHalls).toHaveBeenCalled();
    expect(component.studyHalls().length).toBe(1);
  });

  it('should validate required fields', () => {
    const form = component.announcementForm;
    expect(form.valid).toBeFalsy();

    form.patchValue({
      hallId: 'hall-1',
      title: 'Test Title',
      message: 'This is a test message with sufficient length',
      targetAudience: 'all'
    });

    expect(form.valid).toBeTruthy();
  });

  // ... additional test cases
});
```

[Source: Architecture docs/architecture/testing-strategy.md lines 75-119, docs/architecture/coding-standards.md lines 279-296]

---

### E2E Tests (Playwright)

**Create**: `studymate-frontend/e2e/owner-announcements/announcement-create.spec.ts`

**Critical Workflow Tests**:

1. **AC1 Validation**: Form renders with all required fields
2. **AC2 Validation**: Successful announcement creation flow
3. **AC3 Validation**: Hall dropdown populated correctly
4. **AC5 Validation**: No browser console errors

**Example Playwright Test**:
```typescript
import { test, expect } from '@playwright/test';

test.describe('Owner Announcement Creation', () => {
  test.beforeEach(async ({ page }) => {
    // Login as owner
    await page.goto('/owner/login');
    await page.fill('[data-testid="email"]', 'owner@test.com');
    await page.fill('[data-testid="password"]', 'Test@1234');
    await page.click('[data-testid="login-button"]');
    await page.waitForURL('/owner/dashboard');
  });

  test('AC1: should display announcement creation form with all required fields', async ({ page }) => {
    await page.goto('/owner/announcements/create');

    // Verify all form fields are present
    await expect(page.locator('#hallId')).toBeVisible();
    await expect(page.locator('#title')).toBeVisible();
    await expect(page.locator('#message')).toBeVisible();
    await expect(page.locator('#targetAudience')).toBeVisible();
    await expect(page.locator('#expiresAt')).toBeVisible();

    // Verify buttons
    await expect(page.locator('button:has-text("Cancel")')).toBeVisible();
    await expect(page.locator('button:has-text("Publish Announcement")')).toBeVisible();
  });

  test('AC2: should create announcement successfully', async ({ page }) => {
    await page.goto('/owner/announcements/create');

    // Fill form
    await page.selectOption('#hallId', { index: 1 }); // Select first hall
    await page.fill('#title', 'Important Announcement');
    await page.fill('#message', 'This is a test announcement message with sufficient length');
    await page.selectOption('#targetAudience', 'all');

    // Submit form
    await page.click('button:has-text("Publish Announcement")');

    // Verify success
    await expect(page.locator('[data-testid="toast-success"]')).toContainText('Announcement published successfully');
    await page.waitForURL('/owner/announcements');
  });

  test('AC5: should have zero console errors', async ({ page }) => {
    const consoleErrors: string[] = [];

    page.on('console', (msg) => {
      if (msg.type() === 'error') {
        consoleErrors.push(msg.text());
      }
    });

    await page.goto('/owner/announcements/create');
    await page.waitForTimeout(2000); // Allow time for any errors to appear

    expect(consoleErrors).toHaveLength(0);
  });
});
```

[Source: Architecture docs/architecture/testing-strategy.md lines 170-214, docs/guidelines/coding-standard-guidelines/playwright-rules.md]

---

## Definition of Done

- [ ] All acceptance criteria (AC1-AC5) implemented and verified
- [ ] Unit tests written with 90%+ code coverage
- [ ] All unit tests passing
- [ ] E2E tests written for critical workflows
- [ ] All E2E tests passing with zero console errors
- [ ] Component follows design system standards (Section 9)
- [ ] Code reviewed and approved
- [ ] API integration tested with backend (Story 4.1-backend completed)
- [ ] Responsive design tested on mobile, tablet, desktop
- [ ] Accessibility requirements met (WCAG AA)
- [ ] No TypeScript compilation errors
- [ ] No ESLint warnings
- [ ] Documentation updated (if applicable)
- [ ] Story status updated to "Done"

[Source: Architecture docs/architecture/testing-strategy.md lines 390-401]

---

## Dependencies & Blockers

### Blocked By:
- ⛔ **Story 4.1-backend**: Backend announcement creation API must be implemented first
  - Required endpoint: `POST /owner/announcements`
  - Response format must match `AnnouncementCreateResponse` interface
- ⛔ **Epic 0.1 (Authentication)**: Owner JWT authentication required for API calls
- ⛔ **Story 1.17 (Owner Portal Layout)**: Navigation structure required for accessing announcement creation

### Depends On:
- `ToastService` from shared services (assumed to exist from Epic 1)
- `StudyHallService` from core services (implemented in Epic 1)
- `AuthGuard` and `RoleGuard` from core guards (implemented in Epic 0.1)

[Source: Epic 4 Dependencies section, Epic 1 Feature 1.5]

---

## API Contract Reference

### POST /owner/announcements

**Request**:
```json
{
  "hallId": "uuid",
  "title": "string (max 255)",
  "message": "string (min 10)",
  "targetAudience": "all" | "active_bookings" | "past_students",
  "expiresAt": "ISO 8601 string (optional)"
}
```

**Response (Success - 201 Created)**:
```json
{
  "id": "uuid",
  "message": "Announcement created successfully"
}
```

**Response (Error - 400 Bad Request)**:
```json
{
  "error": "ValidationError",
  "message": "Title is required"
}
```

**Response (Error - 401 Unauthorized)**:
```json
{
  "error": "UnauthorizedError",
  "message": "Invalid or expired token"
}
```

**Authentication**: JWT token in `Authorization: Bearer <token>` header

[Source: Epic 4 API Endpoints table line 131, Epic 4 Feature 6.1]

---

## Architecture References

| Document | Section | Key Information |
|----------|---------|-----------------|
| tech-stack.md | Frontend Stack | Angular 20, Signals, NgRx, Tailwind CSS |
| unified-project-structure.md | Feature Structure | File organization patterns for owner features |
| frontend-architecture.md | Component Patterns | Standalone components, inject(), Signals usage |
| data-models.md | Announcements Table | Database schema (lines 455-484), TypeScript models needed |
| coding-standards.md | Angular Standards | File naming, component organization, TypeScript best practices |
| testing-strategy.md | Testing Requirements | Unit testing (Jasmine), E2E testing (Playwright), 90% coverage |
| components.md | Design Patterns | Smart/Dumb pattern, Signal-based state, naming conventions |
| core-workflows.md | N/A | (Not directly applicable to this story) |
| airbnb-inspired-design-system/index.md | Section 9 | Color palette, typography, spacing, shadows, border radius |

---

## Notes

### Rich Text Editor Decision:
For AC4 (Rich Text Editor), consider these Angular-compatible options:
1. **Quill.js** with ngx-quill wrapper (recommended for simplicity)
2. **CKEditor 5** with @ckeditor/ckeditor5-angular
3. Native `contenteditable` with Angular directive (lightweight but more manual work)

**Recommendation**: Use Quill.js with ngx-quill for MVP due to:
- Easy integration with Angular reactive forms
- Built-in XSS protection
- Lightweight and customizable toolbar
- Good documentation and community support

**Implementation Note**: Rich text editor can be added as an enhancement in a follow-up story if time is constrained. For MVP, a plain textarea is acceptable.

### Future Enhancements:
- Preview mode for announcement before publishing
- Draft save functionality
- Announcement scheduling (publish at future date/time)
- Image attachments in announcements
- Announcement templates

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-14 | 1.0 | Story created from Epic 4 Feature 6.1 | Bob (SM) |

---

**Story Status**: Draft
**Last Updated**: 2025-10-14
**Next Steps**: Review with PO, assign to developer, mark Story 4.1-backend as prerequisite
