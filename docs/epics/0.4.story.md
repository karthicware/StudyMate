# Story 0.4: Setup ESLint and Prettier

## Status
Ready for Review

## Story
**As a** Developer,
**I want** ESLint and Prettier configured for code quality and formatting,
**so that** the codebase maintains consistent style and catches potential issues automatically.

## Acceptance Criteria
1. ESLint installed and configured with Angular-specific rules
2. Prettier installed and configured with project style preferences
3. ESLint and Prettier integration configured to work together
4. Pre-commit hooks configured to run linting and formatting
5. npm scripts created for manual linting and formatting
6. VS Code settings configured for format-on-save

## Tasks / Subtasks
- [x] Task 1: Install ESLint and dependencies (AC: 1)
  - [x] Run `ng add @angular-eslint/schematics` to add Angular ESLint
  - [x] Verify `.eslintrc.json` or `eslint.config.js` created
  - [x] Verify ESLint dependencies added to package.json devDependencies
  - [x] Run `npm install` to ensure package-lock.json updated
- [x] Task 2: Configure ESLint rules for Angular (AC: 1)
  - [x] Extend `@angular-eslint/recommended` configuration
  - [x] Enable TypeScript strict rules (@typescript-eslint/recommended)
  - [x] Configure rules: no-console, no-debugger, no-unused-vars
  - [x] Set up rule overrides for test files (*.spec.ts)
  - [x] Configure indent, quotes, semi rules to match project standards
- [x] Task 3: Install Prettier and dependencies (AC: 2)
  - [x] Run `npm install -D prettier eslint-config-prettier eslint-plugin-prettier`
  - [x] Verify Prettier added to package.json devDependencies
  - [x] Create `.prettierrc.json` configuration file
  - [x] Create `.prettierignore` file for excluded paths
- [x] Task 4: Configure Prettier formatting rules (AC: 2)
  - [x] Set singleQuote: true (matches Angular standards)
  - [x] Set tabWidth: 2 (2-space indentation)
  - [x] Set printWidth: 100 (line length limit)
  - [x] Set trailingComma: 'es5'
  - [x] Set semi: true (always use semicolons)
  - [x] Configure HTML, TypeScript, and SCSS formatting
- [x] Task 5: Integrate ESLint with Prettier (AC: 3)
  - [x] Add 'prettier' to ESLint extends array
  - [x] Add 'plugin:prettier/recommended' to extends
  - [x] Disable conflicting ESLint rules (handled by eslint-config-prettier)
  - [x] Test that ESLint and Prettier work together without conflicts
- [x] Task 6: Create npm scripts for linting and formatting (AC: 5)
  - [x] Add `"lint": "ng lint"` script to package.json
  - [x] Add `"lint:fix": "ng lint --fix"` script for auto-fixing
  - [x] Add `"format": "prettier --write \"src/**/*.{ts,html,scss,json}\""` script
  - [x] Add `"format:check": "prettier --check \"src/**/*.{ts,html,scss,json}\""` script
  - [x] Test all scripts run successfully
- [x] Task 7: Configure VS Code settings (AC: 6)
  - [x] Update `.vscode/settings.json` with editor configuration
  - [x] Enable `editor.formatOnSave: true`
  - [x] Set `editor.defaultFormatter: "esbenp.prettier-vscode"`
  - [x] Configure ESLint auto-fix on save
  - [x] Document required VS Code extensions in README.md
- [x] Task 8: Setup pre-commit hooks with Husky (AC: 4)
  - [x] Run `npm install -D husky lint-staged`
  - [x] Run `npx husky init` to initialize Husky
  - [x] Create `.husky/pre-commit` hook file
  - [x] Configure lint-staged in package.json for staged files
  - [x] Test pre-commit hook runs linting and formatting
- [x] Task 9: Configure lint-staged (AC: 4)
  - [x] Add lint-staged configuration to package.json
  - [x] Configure for TypeScript files: ESLint + Prettier
  - [x] Configure for HTML files: Prettier
  - [x] Configure for SCSS files: Prettier
  - [x] Test hook only runs on staged files
- [x] Task 10: Run linting on existing code (AC: 1, 2)
  - [x] Run `npm run lint` on entire codebase
  - [x] Fix any linting errors found
  - [x] Run `npm run format` to format all files
  - [x] Commit formatted code
- [x] Task 11: Create linting documentation (AC: 1, 2)
  - [x] Document ESLint rules in README.md or CONTRIBUTING.md
  - [x] Document Prettier configuration
  - [x] Add instructions for running lint and format commands
  - [x] Document VS Code extension requirements

## Dev Notes

### Previous Story Insights
**From Story 0.1:**
- Angular 20 project created with TypeScript strict mode
- Project structure established with core/, shared/, features/
- Package.json and npm scripts configured

**From Story 0.2:**
- Tailwind CSS configured
- Build process working

**From Story 0.3:**
- NgRx with Signals configured
- Standalone components pattern established

**Key Learnings:**
- Project follows Angular best practices with standalone components
- TypeScript strict mode already enabled
- 2-space indentation and single quotes standard from Angular rules

### Architecture Overview
[Source: docs/architecture/studymate-system-architecture-blueprint.md#1-technology-stack--environment]
- **Framework**: Angular 20 with TypeScript
- **Build Tool**: Angular CLI
- **Code Quality**: ESLint for linting, Prettier for formatting

### Angular Development Standards
[Source: docs/guidelines/coding-standard-guidelines/angular-rules.md]
- **String Literals**: Use single quotes (')
- **Indentation**: Use 2-space indentation
- **Trailing Whitespace**: Avoid trailing whitespace and unused variables
- **Constants**: Prefer `const` for constants and immutable variables
- **Import Order**: Angular core → RxJS → Angular-specific → App core → Shared → Environment → Relative paths

### ESLint Configuration for Angular
Angular ESLint configuration in `.eslintrc.json`:

```json
{
  "root": true,
  "ignorePatterns": ["projects/**/*"],
  "overrides": [
    {
      "files": ["*.ts"],
      "extends": [
        "eslint:recommended",
        "plugin:@typescript-eslint/recommended",
        "plugin:@angular-eslint/recommended",
        "plugin:@angular-eslint/template/process-inline-templates",
        "plugin:prettier/recommended"
      ],
      "rules": {
        "@angular-eslint/directive-selector": [
          "error",
          {
            "type": "attribute",
            "prefix": "app",
            "style": "camelCase"
          }
        ],
        "@angular-eslint/component-selector": [
          "error",
          {
            "type": "element",
            "prefix": "app",
            "style": "kebab-case"
          }
        ],
        "@typescript-eslint/no-unused-vars": ["error", { "argsIgnorePattern": "^_" }],
        "no-console": ["warn", { "allow": ["warn", "error"] }],
        "no-debugger": "error"
      }
    },
    {
      "files": ["*.html"],
      "extends": [
        "plugin:@angular-eslint/template/recommended",
        "plugin:@angular-eslint/template/accessibility",
        "plugin:prettier/recommended"
      ],
      "rules": {}
    },
    {
      "files": ["*.spec.ts"],
      "rules": {
        "no-console": "off",
        "@typescript-eslint/no-explicit-any": "off"
      }
    }
  ]
}
```

### Prettier Configuration
Create `.prettierrc.json`:

```json
{
  "singleQuote": true,
  "trailingComma": "es5",
  "tabWidth": 2,
  "semi": true,
  "printWidth": 100,
  "arrowParens": "always",
  "endOfLine": "lf",
  "bracketSpacing": true,
  "overrides": [
    {
      "files": "*.html",
      "options": {
        "parser": "angular"
      }
    }
  ]
}
```

Create `.prettierignore`:

```
# Dependencies
node_modules

# Build outputs
dist
.angular
coverage

# IDE
.vscode
.idea

# Misc
*.log
.DS_Store
```

### VS Code Settings
Update `.vscode/settings.json`:

```json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": "explicit"
  },
  "eslint.validate": [
    "javascript",
    "typescript",
    "html"
  ],
  "tailwindCSS.experimental.classRegex": [
    ["class:\\s*['\"]([^'\"]*)['\"]"],
    ["className:\\s*['\"]([^'\"]*)['\"]"]
  ],
  "tailwindCSS.includeLanguages": {
    "typescript": "html",
    "html": "html"
  }
}
```

Required VS Code extensions:
- `dbaeumer.vscode-eslint` - ESLint
- `esbenp.prettier-vscode` - Prettier
- `bradlc.vscode-tailwindcss` - Tailwind CSS IntelliSense (from Story 0.2)

### Husky and lint-staged Configuration
Initialize Husky:
```bash
npx husky init
```

Create `.husky/pre-commit`:
```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

npx lint-staged
```

Add to `package.json`:
```json
{
  "lint-staged": {
    "*.ts": [
      "eslint --fix",
      "prettier --write"
    ],
    "*.html": [
      "prettier --write"
    ],
    "*.scss": [
      "prettier --write"
    ],
    "*.json": [
      "prettier --write"
    ]
  }
}
```

### npm Scripts
Add to `package.json` scripts section:

```json
{
  "scripts": {
    "lint": "ng lint",
    "lint:fix": "ng lint --fix",
    "format": "prettier --write \"src/**/*.{ts,html,scss,json}\"",
    "format:check": "prettier --check \"src/**/*.{ts,html,scss,json}\"",
    "prepare": "husky install"
  }
}
```

### Dependencies
[Source: docs/epics/epic-0-project-foundation-setup.md#frontend-stack]
Required npm packages (devDependencies):
- `@angular-eslint/schematics`: Angular ESLint integration
- `@angular-eslint/eslint-plugin`: Angular-specific ESLint rules
- `@angular-eslint/template-parser`: Template linting
- `@typescript-eslint/eslint-plugin`: TypeScript ESLint rules
- `@typescript-eslint/parser`: TypeScript parser for ESLint
- `eslint`: Core ESLint package
- `prettier`: Code formatter
- `eslint-config-prettier`: Disables conflicting ESLint rules
- `eslint-plugin-prettier`: Runs Prettier as ESLint rule
- `husky`: Git hooks manager
- `lint-staged`: Run linters on staged git files

### ESLint Rule Rationale
Key rules and their purposes:
- `@angular-eslint/directive-selector`: Enforce consistent directive naming (camelCase with 'app' prefix)
- `@angular-eslint/component-selector`: Enforce kebab-case component selectors with 'app' prefix
- `@typescript-eslint/no-unused-vars`: Catch unused variables (allow underscore prefix for intentionally unused)
- `no-console`: Warn on console.log (allow console.warn and console.error)
- `no-debugger`: Prevent debugger statements in production code

### Pre-commit Hook Flow
1. Developer runs `git commit`
2. Husky triggers `.husky/pre-commit` hook
3. lint-staged runs on staged files only:
   - TypeScript files: ESLint fix → Prettier format
   - HTML files: Prettier format
   - SCSS files: Prettier format
4. If linting/formatting passes, commit proceeds
5. If errors found, commit blocked until fixed

### Testing Requirements
[Source: docs/architecture/studymate-system-architecture-blueprint.md#5-testing-architecture--quality-assurance]
- **Manual Testing**: Run lint and format commands on codebase
- **Pre-commit Testing**: Test hook by staging files and committing
- **VS Code Testing**: Verify format-on-save and auto-fix work

### Technical Constraints
[Source: docs/epics/epic-0-project-foundation-setup.md#frontend-stack]
- **Build Tool**: Angular CLI (ESLint integrated via `ng lint`)
- **Node.js**: v20+ LTS
- **Package Manager**: npm

### context7 MCP Integration (MANDATORY)
[Source: docs/architecture/studymate-system-architecture-blueprint.md#context7-mcp-integration-mandatory]
- **Pre-Implementation Query**: `"use context7 - Angular 20 ESLint setup best practices"`
- **Additional Query**: `"use context7 - ESLint Prettier integration TypeScript"`
- **Purpose**: Verify latest ESLint and Prettier configuration for Angular 20

### File Locations
Files created/modified in this story:
- `.eslintrc.json` - ESLint configuration (create new)
- `.prettierrc.json` - Prettier configuration (create new)
- `.prettierignore` - Prettier ignore patterns (create new)
- `.husky/pre-commit` - Pre-commit hook (create new)
- `.vscode/settings.json` - VS Code settings (modify)
- `package.json` - Updated with scripts and lint-staged config (modify)
- `package-lock.json` - Updated dependencies (modify)
- `README.md` - Documentation for linting and formatting (modify)

### Project Structure Notes
No structural changes to Angular project. ESLint and Prettier integrate as development tools that run during development and commit processes.

## Testing

### Manual Testing
- **Lint Test**: Run `npm run lint` - should complete with zero errors
- **Lint Fix Test**: Run `npm run lint:fix` - should auto-fix fixable issues
- **Format Test**: Run `npm run format` - should format all files
- **Format Check Test**: Run `npm run format:check` - should verify formatting
- **VS Code Test**: Edit a file, save, verify auto-format and auto-fix work

### Pre-commit Hook Testing
- **Stage Files**: Stage TypeScript, HTML, and SCSS files
- **Commit Test**: Run `git commit` - hook should run lint-staged
- **Error Test**: Stage file with linting errors, verify commit blocked
- **Success Test**: Stage properly formatted files, verify commit succeeds

### Success Criteria Validation
1. ✅ ESLint installed with Angular-specific rules configured
2. ✅ Prettier installed with project style preferences set
3. ✅ ESLint and Prettier work together without conflicts
4. ✅ Pre-commit hooks run linting and formatting automatically
5. ✅ npm scripts available for manual lint/format operations
6. ✅ VS Code format-on-save working

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-10 | 1.0 | Story created from Epic 0, Feature 0.1 | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log References
None

### Completion Notes List
- Angular ESLint v20.3.0 installed via `ng add @angular-eslint/schematics`
- ESLint configured with TypeScript strict rules, Angular-specific rules, and custom rules for console/debugger/unused-vars
- Prettier v3.6.2 installed with eslint-config-prettier and eslint-plugin-prettier
- ESLint and Prettier integrated via eslint-plugin-prettier/recommended
- All npm scripts (lint, lint:fix, format, format:check) created and tested
- VS Code settings updated for format-on-save and ESLint auto-fix
- Husky v9.1.7 and lint-staged v16.2.3 installed and configured
- Pre-commit hook created to run lint-staged on staged files
- All existing code linted and formatted successfully (26 issues auto-fixed)
- README.md updated with comprehensive code quality documentation

### File List
- `eslint.config.js` - ESLint configuration (created)
- `.prettierrc.json` - Prettier configuration (created)
- `.prettierignore` - Prettier ignore patterns (created)
- `.husky/pre-commit` - Pre-commit hook (created)
- `.vscode/settings.json` - VS Code settings (modified)
- `package.json` - Added scripts and lint-staged config (modified)
- `package-lock.json` - Updated dependencies (modified)
- `README.md` - Added code quality documentation (modified)
- `angular.json` - Updated by Angular ESLint schematics (modified)
- All source files in `src/` - Formatted by Prettier (modified)

## QA Results
_To be filled by QA Agent_
