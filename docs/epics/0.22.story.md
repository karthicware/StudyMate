# Story 0.22: Implement Login and Registration Endpoints

## Status
Draft

## Story
**As a** Developer,
**I want** login and registration REST endpoints,
**so that** users can authenticate and create accounts.

## Acceptance Criteria
1. AuthController created with /auth endpoints
2. POST /auth/register creates new users
3. POST /auth/login authenticates and returns JWT
4. GET /auth/me returns current user profile
5. Request/response DTOs created and validated
6. Endpoints tested with valid and invalid data

## Tasks / Subtasks
- [ ] Task 1: Create DTOs (AC: 5)
  - [ ] CreateLoginRequest (email, password)
  - [ ] CreateRegisterRequest (email, password, firstName, lastName, role)
  - [ ] CreateAuthResponse (token, user info)
  - [ ] Add validation annotations
- [ ] Task 2: Create AuthController (AC: 1)
  - [ ] Map to /api/auth
  - [ ] Inject AuthService, UserService
  - [ ] Add proper error handling
- [ ] Task 3: Implement registration (AC: 2)
  - [ ] POST /api/auth/register
  - [ ] Validate input
  - [ ] Check email doesn't exist
  - [ ] Hash password
  - [ ] Save user
  - [ ] Return success response
- [ ] Task 4: Implement login (AC: 3)
  - [ ] POST /api/auth/login
  - [ ] Validate credentials
  - [ ] Generate JWT token
  - [ ] Return token in response
  - [ ] Handle invalid credentials
- [ ] Task 5: Implement get current user (AC: 4)
  - [ ] GET /api/auth/me
  - [ ] Extract user from SecurityContext
  - [ ] Return user profile
  - [ ] Handle unauthenticated requests
- [ ] Task 6: Create integration tests (AC: 6)
  - [ ] Test successful registration
  - [ ] Test duplicate email registration
  - [ ] Test successful login
  - [ ] Test invalid credentials
  - [ ] Test get current user with valid token

## Dev Notes

### DTOs
```java
@Data
public class LoginRequest {
    @NotBlank @Email
    private String email;
    @NotBlank
    private String password;
}

@Data
public class RegisterRequest {
    @NotBlank @Email
    private String email;
    @NotBlank @Size(min = 8)
    private String password;
    @NotBlank
    private String firstName;
    private String lastName;
    @NotNull
    private UserRole role;
}

@Data
public class AuthResponse {
    private String token;
    private String email;
    private String role;
}
```

### Endpoints
- POST /api/auth/register
- POST /api/auth/login
- GET /api/auth/me
- POST /api/auth/logout (optional)

## Testing
Test all endpoints with MockMvc and real database

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-10 | 1.0 | Story created from Epic 0, Feature 0.5 | Bob (Scrum Master) |
