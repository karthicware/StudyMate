# Story 2.8-Backend: Implement Student Profile & Dashboard APIs

## Status
Draft

## Story
**As a** Backend Developer,
**I want** student profile and dashboard APIs implemented,
**so that** students can manage their profiles and view their booking history.

## Acceptance Criteria
1. GET `/student/dashboard` - Student dashboard with active bookings, upcoming, history
2. GET `/student/profile` - Get current student profile
3. PUT `/student/profile` - Update student profile
4. GET `/booking/history/{userId}` - Booking history with pagination
5. Students can only access their own data
6. PostgreSQL MCP validation

## Tasks / Subtasks
- [ ] Create StudentController with profile endpoints
- [ ] Create StudentDashboardService
- [ ] Implement dashboard data aggregation (active, upcoming, past bookings)
- [ ] Add profile update validation (email uniqueness, required fields)
- [ ] Implement booking history with pagination and filtering
- [ ] Verify student can only access own data
- [ ] Create DTOs (DashboardResponse, ProfileResponse, UpdateProfileRequest)
- [ ] Create comprehensive tests
- [ ] Validate with PostgreSQL MCP

## Dev Notes

### Dashboard Aggregation
```java
public StudentDashboardResponse getDashboard(Long userId) {
    LocalDateTime now = LocalDateTime.now();

    // Active bookings (currently ongoing)
    List<BookingSummary> active = bookingRepository
        .findActiveBookings(userId, now);

    // Upcoming bookings (future)
    List<BookingSummary> upcoming = bookingRepository
        .findUpcomingBookings(userId, now);

    // Recent history (last 30 days)
    List<BookingSummary> recent = bookingRepository
        .findRecentHistory(userId, now.minusDays(30), now);

    return StudentDashboardResponse.builder()
        .activeBookings(active)
        .upcomingBookings(upcoming)
        .recentHistory(recent)
        .build();
}
```

### Profile Update Validation
- Email uniqueness check (except current user)
- Required fields: firstName, email
- Optional: lastName, phone, preferences

### File Locations
- Controller: `controller/StudentController.java`
- Service: `service/StudentDashboardService.java`, `service/StudentProfileService.java`
- DTOs: `dto/StudentDashboardResponse.java`, `dto/ProfileResponse.java`

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-10 | 1.0 | Student profile & dashboard APIs | Bob (Scrum Master) |
