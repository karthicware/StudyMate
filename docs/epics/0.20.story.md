# Story 0.20: Implement User Entity and Repository

## Status
Draft

## Story
**As a** Developer,
**I want** User entity properly configured for authentication,
**so that** user credentials and roles are stored securely.

## Acceptance Criteria
1. User entity updated with password hashing support
2. User roles enum created (OWNER, STUDENT)
3. UserRepository updated with authentication queries
4. Password encoder bean configured
5. User entity validated against database schema
6. Sample test users created for development

## Tasks / Subtasks
- [ ] Task 1: Update User entity (AC: 1)
  - [ ] Ensure password_hash field exists
  - [ ] Add email validation
  - [ ] Update role field with enum
  - [ ] Add account status fields (enabled, locked)
- [ ] Task 2: Create UserRole enum (AC: 2)
  - [ ] Define OWNER and STUDENT roles
  - [ ] Add ROLE_ prefix for Spring Security
  - [ ] Implement in User entity
- [ ] Task 3: Update UserRepository (AC: 3)
  - [ ] Add findByEmail method
  - [ ] Add existsByEmail method
  - [ ] Ensure @Repository annotation
- [ ] Task 4: Configure PasswordEncoder (AC: 4)
  - [ ] Create PasswordEncoder bean (BCrypt)
  - [ ] Add to SecurityConfig
  - [ ] Document encoding strength
- [ ] Task 5: Verify against database schema (AC: 5)
  - [ ] Use PostgreSQL MCP to check users table
  - [ ] Verify column names match entity
  - [ ] Verify constraints align
- [ ] Task 6: Create test data script (AC: 6)
  - [ ] Create V2__test_users.sql migration
  - [ ] Insert owner test user
  - [ ] Insert student test user
  - [ ] Use BCrypt hashed passwords

## Dev Notes
User entity from Story 0.7 needs authentication enhancements.

### UserRole Enum
```java
public enum UserRole {
    ROLE_OWNER,
    ROLE_STUDENT
}
```

### PasswordEncoder Bean
```java
@Bean
public PasswordEncoder passwordEncoder() {
    return new BCryptPasswordEncoder();
}
```

## Testing
- Verify User entity maps to database
- Test password encoding/validation
- Test repository queries

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-10 | 1.0 | Story created from Epic 0, Feature 0.5 | Bob (Scrum Master) |
