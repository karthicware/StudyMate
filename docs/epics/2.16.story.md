# Story 2.16: Interactive Seat Map Display with Space Type Visual Differentiation (Frontend)

## Status
Draft

## Story
**As a** Student,
**I want** to view an interactive seat map with real-time availability and space type visual differentiation
**so that** I can easily identify seat availability, space types (Cabin, Seat Row, 4-Person Table, Study Pod, Meeting Room, Lounge Area), and maintenance status before making my booking selection.

## Acceptance Criteria

### AC1: The map must show real-time availability with space type visual differentiation
**Given** a student is viewing the seat map for booking
**When** the seat map loads seat data from `GET /booking/seats/{hallId}`
**Then** the system displays:
- **Green (#22c55e)** = Available seats
- **Red (#ef4444)** = Booked seats
- **Orange (#FFA500)** = Maintenance seats (not selectable, grayed out)
- **Distinct icons/shapes per space type**:
  - **Cabin**: Small square with single-person icon
  - **Seat Row**: Horizontal rectangle with multiple dots
  - **4-Person Table**: Square with 4-person icon
  - **Study Pod**: Rounded rectangle
  - **Meeting Room**: Large rectangle
  - **Lounge Area**: Irregular shape or couch icon
- Each seat displays its seat number label
- Seat colors reflect status (available/booked/maintenance)
- Seat shapes/icons reflect space type

### AC2: Selection triggers seat lock and reservation process
**Given** a student clicks on an available seat
**When** the seat is in 'available' status
**Then** the system:
- Sends `POST /booking/seats/lock` request with seatId and userId
- Displays loading indicator during lock request
- On success: Highlights selected seat with blue border (#3b82f6)
- On success: Proceeds to booking confirmation flow
- On failure: Shows error toast "Seat is no longer available"
- On failure: Refreshes seat map to reflect current availability

**When** the seat is in 'booked' or 'maintenance' status
**Then** the system:
- Does not send lock request
- Shows tooltip message: "This seat is not available"
- No visual change to seat

### AC3: Maintenance seats are grayed out and not clickable
**Given** a seat has status 'maintenance'
**When** the seat is rendered on the map
**Then** the system:
- Displays seat with orange background (#FFA500)
- Applies dark orange border (#FF8C00)
- Shows wrench icon ðŸ”§ in top-right corner
- Sets cursor to 'not-allowed'
- Disables click event handler
- Reduces opacity to 0.8
- Displays space type icon (but grayed out)

**When** the student hovers over maintenance seat
**Then** the system shows tooltip:
- "Under Maintenance"
- Space type name (e.g., "Cabin - Under Maintenance")
- Maintenance reason (if available)

### AC4: Tooltip on hover shows space type name and maintenance status
**Given** a student hovers over any seat
**When** the mouse enters seat boundary
**Then** the system displays tooltip with:
- Seat number (e.g., "A1")
- Space type name (e.g., "Cabin")
- Status (Available, Booked, or "Under Maintenance: [reason]")
- Custom price (if applicable, e.g., "â‚¹200/hr")

**Tooltip Examples**:
- Available Cabin: "A1 - Cabin | Available | â‚¹150/hr"
- Booked Meeting Room: "B5 - Meeting Room | Booked"
- Maintenance Seat: "C3 - Study Pod | Under Maintenance: Cleaning"

### AC5: Seat map updates in real-time when availability changes
**Given** the student is viewing the seat map
**When** another student books a seat or a maintenance status changes
**Then** the system:
- Polls `GET /booking/seats/{hallId}` every 5 seconds (or uses WebSocket if implemented)
- Updates seat colors and statuses without full page reload
- Shows brief animation when seat status changes (fade transition)
- Maintains current scroll position and zoom level

## Tasks / Subtasks

### Task 1: Create Interactive Seat Map Component (AC: 1, 4, 5)
- [ ] Generate `seat-map-display.component.ts` in `features/student/booking/`
- [ ] Create canvas element (HTML5 Canvas or SVG-based) for seat layout
- [ ] Fetch seat data on component init via `GET /booking/seats/{hallId}`
- [ ] Implement seat rendering logic with space type icons/shapes
- [ ] Apply color coding based on seat status (available/booked/maintenance)
- [ ] Add seat number labels to each seat visual
- [ ] Implement hover tooltip showing seat details (seat number, space type, status, price)
- [ ] Implement real-time polling (5-second interval) for seat availability updates
- [ ] Add fade transition animation when seat status changes

### Task 2: Create Space Type Icon/Shape Library (AC: 1, 4)
- [ ] Define SVG icons for each space type:
  - Cabin: Small square (40px Ã— 40px) with single-person icon
  - Seat Row: Horizontal rectangle (60px Ã— 40px) with 3 dots
  - 4-Person Table: Square (60px Ã— 60px) with 4-person icon
  - Study Pod: Rounded rectangle (50px Ã— 50px) with curved corners
  - Meeting Room: Large rectangle (80px Ã— 60px) with table icon
  - Lounge Area: Irregular shape (60px Ã— 60px) with couch icon
- [ ] Create reusable icon component or SVG definitions
- [ ] Apply space type icon to each seat based on `seat.spaceType` field
- [ ] Ensure icons scale proportionally with seat container
- [ ] Add space type icon to tooltip content

### Task 3: Implement Seat Status Styling (AC: 1, 3)
- [ ] Create CSS classes for seat statuses:
  - `.seat-available`: Green background (#22c55e), white text, pointer cursor
  - `.seat-booked`: Red background (#ef4444), white text, not-allowed cursor
  - `.seat-maintenance`: Orange background (#FFA500), dark orange border (#FF8C00), not-allowed cursor, opacity 0.8
  - `.seat-selected`: Blue border (#3b82f6), blue shadow
- [ ] Apply CSS classes dynamically based on `seat.status`
- [ ] Add wrench icon ðŸ”§ to maintenance seats (::after pseudo-element)
- [ ] Disable click events for booked and maintenance seats
- [ ] Implement hover effect for available seats (scale 1.05, shadow)
- [ ] Remove hover effect for booked and maintenance seats

### Task 4: Implement Seat Selection & Locking Logic (AC: 2)
- [ ] Create `selectSeat(seat: Seat): void` method
- [ ] Check if seat status is 'available' before proceeding
- [ ] Call `seatLockingService.lockSeat(seatId, userId)` to POST to `/booking/seats/lock`
- [ ] Display loading spinner on selected seat during lock request
- [ ] On success: Apply `.seat-selected` class to highlight seat
- [ ] On success: Emit `@Output() seatSelected = new EventEmitter<Seat>()`
- [ ] On failure: Show error toast "Seat is no longer available"
- [ ] On failure: Refresh seat map by re-fetching seat data
- [ ] Handle race conditions (two students clicking same seat simultaneously)

### Task 5: Create Seat Locking Service (AC: 2)
- [ ] Create `seat-locking.service.ts` in `core/services/`
- [ ] Implement `lockSeat(seatId: string, userId: string): Observable<SeatLockResponse>`
- [ ] Send POST request to `/booking/seats/lock` with `{ seatId, userId }`
- [ ] Handle success response: `{ locked: true, seatId, lockExpiry }`
- [ ] Handle error responses:
  - 409 Conflict: "Seat already locked"
  - 404 Not Found: "Seat not found"
  - 403 Forbidden: "Seat not available"
- [ ] Add retry logic for network failures (max 1 retry)
- [ ] Store lock expiry time in component state

### Task 6: Implement Tooltip Component (AC: 4)
- [ ] Create `seat-tooltip.component.ts` in `features/student/booking/`
- [ ] Accept `@Input() seat: Seat` to display seat details
- [ ] Display tooltip content:
  - Line 1: Seat number (e.g., "A1")
  - Line 2: Space type (e.g., "Cabin")
  - Line 3: Status (Available, Booked, or "Under Maintenance: [reason]")
  - Line 4: Price (e.g., "â‚¹150/hr" or "â‚¹200/hr (custom)")
- [ ] Position tooltip above seat on hover (absolute positioning)
- [ ] Add arrow pointing to seat
- [ ] Implement fade-in/fade-out animation (300ms)
- [ ] Ensure tooltip stays within viewport bounds (adjust position if near edge)

### Task 7: Implement Real-time Seat Availability Updates (AC: 5)
- [ ] Create `interval(5000)` observable for polling
- [ ] Subscribe to interval in component `ngOnInit()`
- [ ] Fetch seat data every 5 seconds via `GET /booking/seats/{hallId}`
- [ ] Compare new seat data with current state
- [ ] Detect seat status changes (available â†’ booked, etc.)
- [ ] Apply fade transition animation to changed seats (300ms)
- [ ] Update seat map without full page reload
- [ ] Maintain scroll position and zoom level during updates
- [ ] Unsubscribe from interval on component destroy

### Task 8: Create Seat Map Legend (AC: 1)
- [ ] Create legend component showing:
  - Available (green square with Cabin icon)
  - Booked (red square with Cabin icon)
  - Maintenance (orange square with wrench icon)
  - Space type examples (one icon per type)
- [ ] Position legend in top-right corner of seat map
- [ ] Make legend always visible (sticky positioning)
- [ ] Add labels for each legend item

### Task 9: Component Testing (Unit & E2E)
- [ ] Unit tests for `seat-map-display.component.ts`:
  - Seat rendering with correct colors based on status
  - Space type icons applied correctly
  - Seat selection only works for available seats
  - Maintenance seats are not clickable
  - Tooltip displays correct information
  - Real-time polling updates seat statuses
- [ ] Unit tests for `seat-locking.service.ts`:
  - POST request sent to `/booking/seats/lock`
  - Success response handled correctly
  - Error responses handled with appropriate messages
- [ ] E2E tests (Playwright) using Story 0.25 test infrastructure:
  - Student logs in and navigates to seat map
  - Seat map loads with correct seat colors and icons
  - Hovering over seat shows tooltip
  - Clicking available seat triggers lock request
  - Clicking booked/maintenance seat does nothing
  - Seat status updates in real-time (simulate booking from backend)
  - Error handling when lock fails
  - Verify backend receives correct POST request

## Dev Notes

### Previous Story Insights
**From Story 1.4 (Seat Map Editor - Frontend):**
- Owner-facing seat map editor implements drag-and-drop and space type selection
- Space type dropdown has 6 options: Cabin, Seat Row, 4-Person Table, Study Pod, Meeting Room, Lounge Area
- Distinct icons/shapes per space type already defined in Story 1.4 Task 3
- This story (2.16) is the student-facing READ-ONLY version with booking functionality

**From Story 1.23 (Seat Maintenance Management UI - Frontend):**
- Maintenance seats display with orange background (#FFA500)
- Dark orange border (#FF8C00)
- Wrench icon ðŸ”§ in top-right corner
- Cursor: not-allowed
- Opacity: 0.8
- This story (2.16) must match maintenance seat styling from Story 1.23

**From Story 2.1-backend (Seat Booking APIs Implementation):**
- Backend API `GET /booking/seats/{hallId}` returns seat availability data
- Backend API `POST /booking/seats/lock` locks seat for 10 minutes during payment
- Seat locking uses pessimistic locking to prevent double-booking
- Lock expiry automatically handled by backend scheduled job

### Data Models

**TypeScript Seat Interface** (Frontend):
[Source: docs/architecture/data-models.md#seat-models]
```typescript
export interface Seat {
  id: string;
  hallId: string;
  seatNumber: string;
  xCoord: number;
  yCoord: number;
  status: 'available' | 'booked' | 'locked' | 'maintenance';
  spaceType: 'Cabin' | 'Seat Row' | '4-Person Table' | 'Study Pod' | 'Meeting Room' | 'Lounge Area';
  customPrice?: number;
  maintenanceReason?: string;
  maintenanceStarted?: Date;
  maintenanceUntil?: Date;
  lockedBy?: string;
  lockedAt?: Date;
  lockExpiry?: Date;
  createdAt: Date;
  updatedAt: Date;
}
```

**Seat Status Color Mapping**:
```typescript
const SEAT_STATUS_COLORS = {
  available: '#22c55e',  // Green
  booked: '#ef4444',     // Red
  locked: '#9ca3af',     // Gray
  maintenance: '#FFA500' // Orange
};
```

**Space Type Icons**:
[Source: Story 1.4 Task 3]
- Cabin: Small square with single-person icon
- Seat Row: Horizontal rectangle with multiple dots
- 4-Person Table: Square with 4-person icon
- Study Pod: Rounded rectangle
- Meeting Room: Large rectangle
- Lounge Area: Irregular shape or couch icon

### API Specifications

**GET /booking/seats/{hallId}** - Retrieve real-time seat status for map
[Source: Epic 2 API Endpoints, Story 2.1-backend]
- Method: GET
- Authorization: JWT token with STUDENT role
- Path Parameter: `hallId` (UUID)
- Response: 200 OK
  ```json
  {
    "seats": [
      {
        "id": "uuid",
        "seatNumber": "A1",
        "xCoord": 100,
        "yCoord": 150,
        "status": "available",
        "spaceType": "Cabin",
        "customPrice": null,
        "maintenanceReason": null
      },
      {
        "id": "uuid2",
        "seatNumber": "A2",
        "xCoord": 200,
        "yCoord": 150,
        "status": "booked",
        "spaceType": "Meeting Room",
        "customPrice": 250
      },
      {
        "id": "uuid3",
        "seatNumber": "B1",
        "xCoord": 100,
        "yCoord": 250,
        "status": "maintenance",
        "spaceType": "Study Pod",
        "maintenanceReason": "Cleaning"
      }
    ]
  }
  ```

**POST /booking/seats/lock** - Lock a specific seat during payment window
[Source: Epic 2 API Endpoints, Story 2.1-backend]
- Method: POST
- Authorization: JWT token with STUDENT role
- Request Body:
  ```json
  {
    "seatId": "uuid",
    "userId": "uuid"
  }
  ```
- Response: 200 OK
  ```json
  {
    "locked": true,
    "seatId": "uuid",
    "lockExpiry": "2025-10-17T10:10:00Z"
  }
  ```
- Error Responses:
  - 409 Conflict: `{ "error": "Seat already locked" }`
  - 404 Not Found: `{ "error": "Seat not found" }`
  - 403 Forbidden: `{ "error": "Seat not available" }`

### Component Specifications

**Component**: `SeatMapDisplayComponent`
[Source: Angular 20 component patterns, docs/guidelines/coding-standard-guidelines/angular-rules.md]
- Location: `studymate-frontend/src/app/features/student/booking/seat-map-display/seat-map-display.component.ts`
- Type: Smart Component (manages state, API calls)
- State Management: NgRx Signals for seat availability state
- Real-time Updates: RxJS interval polling (5 seconds) or WebSocket (future enhancement)
- Responsibilities:
  - Fetch seat data from API
  - Render seat map with space type icons and status colors
  - Handle seat selection and locking
  - Display tooltips on hover
  - Update seat statuses in real-time
  - Emit seat selection event to parent component

**Component**: `SeatTooltipComponent`
[Source: Angular 20 component patterns]
- Location: `studymate-frontend/src/app/features/student/booking/seat-tooltip/seat-tooltip.component.ts`
- Type: Presentational Component (receives data via @Input)
- Inputs: `@Input() seat: Seat`
- Responsibilities:
  - Display seat details in tooltip
  - Position tooltip above seat
  - Handle viewport boundary detection

**Service**: `SeatLockingService`
[Source: Angular 20 service patterns]
- Location: `studymate-frontend/src/app/core/services/seat-locking.service.ts`
- Responsibilities:
  - HTTP POST to `/booking/seats/lock`
  - Error handling for lock failures
  - Response transformation (DTO to model)
- Injectable: Root

### File Locations
[Source: docs/architecture/unified-project-structure.md]
- **Components**:
  - `studymate-frontend/src/app/features/student/booking/seat-map-display/seat-map-display.component.ts`
  - `studymate-frontend/src/app/features/student/booking/seat-map-display/seat-map-display.component.html`
  - `studymate-frontend/src/app/features/student/booking/seat-map-display/seat-map-display.component.scss`
  - `studymate-frontend/src/app/features/student/booking/seat-tooltip/seat-tooltip.component.ts`
  - `studymate-frontend/src/app/features/student/booking/seat-tooltip/seat-tooltip.component.html`
  - `studymate-frontend/src/app/features/student/booking/seat-tooltip/seat-tooltip.component.scss`

- **Services**:
  - `studymate-frontend/src/app/core/services/seat-locking.service.ts`

- **Models**:
  - `studymate-frontend/src/app/core/models/seat.model.ts` (reuse from Story 1.4)

- **Tests**:
  - `studymate-frontend/src/app/features/student/booking/seat-map-display/seat-map-display.component.spec.ts`
  - `studymate-frontend/src/app/features/student/booking/seat-tooltip/seat-tooltip.component.spec.ts`
  - `studymate-frontend/src/app/core/services/seat-locking.service.spec.ts`

- **E2E Tests**:
  - `studymate-frontend/e2e/student-seat-booking.spec.ts`

### Technical Constraints

**Real-time Updates**:
- Use RxJS `interval(5000)` for polling every 5 seconds
- Alternative: WebSocket connection for push-based updates (future enhancement)
- Update seat statuses without full page reload
- Maintain scroll position and zoom level during updates

**Space Type Visual Differentiation**:
- Each space type must have distinct icon or shape
- Use SVG icons from a library (e.g., Heroicons, Material Icons) or custom SVG
- Color coding based on status (available/booked/maintenance)
- Icon size: 24px Ã— 24px inside seat container
- Seat container size varies by space type (see Task 2)

**Seat Locking**:
- Lock request must be idempotent (backend handles duplicate requests)
- Lock expires after 10 minutes (backend enforcement)
- Frontend displays lock expiry countdown timer (future enhancement)
- Handle race conditions gracefully (show error toast if lock fails)

**Authorization**:
- JWT token required for all `/booking/**` endpoints
- Token included in Authorization header: `Bearer <token>`
- Token managed by AuthService (from Epic 0.1)
- 401 Unauthorized â†’ redirect to login
- 403 Forbidden â†’ show error toast "You are not authorized to book this seat"

### Testing Requirements

**Unit Testing**:
[Source: docs/guidelines/coding-standard-guidelines/angular-rules.md]
- Framework: Jasmine + Karma
- Test file location: Same directory as component, suffix `.spec.ts`
- Coverage: 90%+ for all components and services
- Mock HTTP calls with `HttpClientTestingModule`
- Test patterns:
  - Component initialization
  - Seat rendering with correct colors and icons
  - Seat selection logic (available vs. booked/maintenance)
  - Tooltip display and positioning
  - Real-time polling and status updates
  - Service method calls
  - Event emissions (@Output)
  - State updates (NgRx Signals)

**E2E Integration Testing Requirements**:
[Source: Template section - E2E Integration Testing]
- Use Story 0.25 test infrastructure (backend test server on port 8081, test database `studymate`)
- Critical user workflow to test:
  1. Student logs in
  2. Navigates to seat map for specific hall
  3. Views seat map with different seat statuses and space types
  4. Hovers over seat to see tooltip
  5. Clicks available seat
  6. Verifies seat lock request sent to backend
  7. Verifies seat highlighted with blue border
  8. Verifies error handling when clicking booked/maintenance seat
  9. Simulates real-time update (backend changes seat status)
  10. Verifies seat color changes without page reload

- API Integration:
  - **GET /booking/seats/{hallId}** - Validate seat data loaded with space types and statuses
  - **POST /booking/seats/lock** - Validate seat locking with correct payload

- Test Data Requirements:
  - Use `generateTestEmail()` for unique student test user
  - Create test study hall in `studymate` database with seats of different space types
  - Create seats with various statuses: available, booked, maintenance
  - Use fixtures from `e2e/fixtures/` or create new `seat-booking.fixture.ts`

- Expected E2E Tests:
  - Student can view seat map with space type icons
  - Seat colors reflect status (available=green, booked=red, maintenance=orange)
  - Tooltip shows seat details on hover
  - Student can click available seat and lock is created
  - Student cannot click booked/maintenance seats
  - Error toast displays when lock fails
  - Seat status updates in real-time (polling every 5 seconds)
  - Backend validates and persists seat lock
  - Success feedback displayed after seat selection

- Test Utilities:
  - `e2e/utils/loginAsStudent()` - Authenticate as student
  - `e2e/utils/navigateToSeatMap(hallId)` - Navigate to seat map page
  - `e2e/utils/waitForSeatMapLoad()` - Wait for seat data to load
  - Create new: `e2e/utils/hoverSeat(seatNumber)` - Hover over seat to show tooltip
  - Create new: `e2e/utils/clickSeat(seatNumber)` - Click seat and wait for lock request

- Reference: `docs/testing/e2e-testing-guide.md` for patterns

**Browser Console Requirements**:
[Source: Epic 2 Testing Requirements]
- Zero console errors/warnings during testing
- Use Playwright `page.on('console')` to capture console messages
- Fail test if console.error() or console.warn() detected

**PostgreSQL MCP Validation**:
[Source: Epic 2 Testing Requirements]
- After E2E test locks a seat, query database to verify:
  ```sql
  SELECT id, seat_number, status, locked_by, locked_at, lock_expiry
  FROM seats
  WHERE hall_id = <test_hall_id> AND seat_number = 'A1';
  ```
- Verify status is 'locked'
- Verify `locked_by` is set to student user ID
- Verify `lock_expiry` is ~10 minutes from `locked_at`

### Project Structure Notes
- Angular 20 standalone components (no NgModule)
- Tailwind CSS for styling (no custom CSS unless absolutely necessary)
- NgRx Signals for state management (not NgRx Store)
- RxJS for real-time polling
- Context7 MCP must be used for Angular 20 API documentation

## E2E Integration Testing Requirements

### MANDATORY REQUIREMENTS (Read Before Implementation)
- **UI Locators**: ALL UI elements MUST have data-testid locators â†’ `docs/guidelines/ui-testing-locators-mandatory.md`
- **E2E Quality Gates**: ALL E2E tests MUST follow the 6 Critical Quality Gates â†’ `docs/guidelines/e2e-quality-gates-mandatory.md`
- **QA Validation**: QA Agent must validate against â†’ `.bmad-core/checklists/e2e-quality-gate-checklist.md`
- **Dev Agent**: Read BOTH mandatory guideline files BEFORE writing any E2E tests

### Use Story 0.25 Test Infrastructure
- Backend test server on port 8081
- Test database: `studymate`
- Separate test user accounts with STUDENT role

### Critical User Workflow to Test End-to-End
1. Student logs in with test credentials
2. Navigates to seat map page for specific test hall
3. Seat map loads with seats of different statuses (available, booked, maintenance) and space types
4. Student hovers over Cabin seat â†’ tooltip shows "A1 - Cabin | Available | â‚¹150/hr"
5. Student hovers over Meeting Room seat â†’ tooltip shows "B5 - Meeting Room | Booked"
6. Student hovers over maintenance seat â†’ tooltip shows "C3 - Study Pod | Under Maintenance: Cleaning"
7. Student clicks available Cabin seat A1
8. Seat lock request sent to backend: `POST /booking/seats/lock`
9. Backend responds with lock confirmation
10. Seat A1 highlighted with blue border
11. Student clicks booked seat B5 â†’ No action, tooltip shows "This seat is not available"
12. Simulate seat status change from backend (seat A2 changes from available to booked)
13. After 5 seconds, seat map updates without page reload
14. Seat A2 color changes from green to red with fade animation
15. Student attempts to click maintenance seat C3 â†’ No action, cursor shows not-allowed
16. Verify backend database shows seat A1 is locked by student user

### API Endpoints to Validate
- **GET /booking/seats/{hallId}** - Returns seat data with space types, statuses, coordinates
- **POST /booking/seats/lock** - Locks seat for 10 minutes, returns lock confirmation

### Test Data Requirements
- Create test study hall with ID `test-hall-001` in `studymate` database
- Create seats with different space types:
  - A1: Cabin, available
  - A2: Seat Row, available
  - B1: 4-Person Table, available
  - B5: Meeting Room, booked
  - C3: Study Pod, maintenance (reason: "Cleaning")
  - D1: Lounge Area, available
- Create student test user with email `student-test@example.com`

### Expected E2E Tests
1. **Test: Seat map loads with correct space type icons and status colors**
   - Given: Student logged in and navigated to seat map
   - When: Seat map loads
   - Then:
     - A1 (Cabin) displays with green background and Cabin icon
     - B5 (Meeting Room) displays with red background and Meeting Room icon
     - C3 (Study Pod) displays with orange background and wrench icon
     - All seats positioned at correct coordinates

2. **Test: Tooltip displays seat details on hover**
   - Given: Seat map is loaded
   - When: Student hovers over A1
   - Then: Tooltip shows "A1 - Cabin | Available | â‚¹150/hr"

3. **Test: Student can select available seat and lock is created**
   - Given: Seat A1 is available
   - When: Student clicks A1
   - Then:
     - POST request sent to `/booking/seats/lock` with `{ seatId: "a1-uuid", userId: "student-uuid" }`
     - Backend responds with `{ locked: true, seatId: "a1-uuid", lockExpiry: "..." }`
     - A1 displays blue border
     - `seatSelected` event emitted

4. **Test: Student cannot select booked seat**
   - Given: Seat B5 is booked
   - When: Student clicks B5
   - Then:
     - No POST request sent
     - Tooltip shows "This seat is not available"
     - No visual change to B5

5. **Test: Student cannot select maintenance seat**
   - Given: Seat C3 is under maintenance
   - When: Student clicks C3
   - Then:
     - No POST request sent
     - Cursor shows not-allowed
     - No visual change to C3

6. **Test: Seat status updates in real-time**
   - Given: Seat A2 is initially available (green)
   - When: Backend changes A2 status to booked
   - And: 5 seconds elapse (polling interval)
   - Then:
     - Component fetches updated seat data
     - A2 color changes from green to red
     - Fade transition animation applied

7. **Test: Error handling when seat lock fails**
   - Given: Seat A1 is available
   - When: Student clicks A1
   - And: Another student has already locked A1 (backend returns 409 Conflict)
   - Then:
     - Error toast displays: "Seat is no longer available"
     - Seat map refreshes to show A1 as locked

8. **Test: PostgreSQL MCP validation of seat lock**
   - Given: Student has clicked and locked seat A1
   - When: E2E test queries database:
     ```sql
     SELECT status, locked_by, lock_expiry FROM seats WHERE seat_number = 'A1';
     ```
   - Then:
     - status = 'locked'
     - locked_by = student user UUID
     - lock_expiry is ~10 minutes from now

### Test Utilities
- `loginAsStudent()` - Authenticate student user
- `navigateToSeatMap(hallId)` - Navigate to seat map page
- `waitForSeatMapLoad()` - Wait for seat data to load
- `hoverSeat(seatNumber)` - Hover over seat and verify tooltip
- `clickSeat(seatNumber)` - Click seat and wait for lock request
- `verifyBackendSeatLock(seatNumber)` - Query database via PostgreSQL MCP to verify lock

### Browser Console Requirements
- Zero console errors or warnings during E2E tests
- Use Playwright `page.on('console')` to capture and fail on errors

## Dev Agent Record
<!-- Dev agent will populate this section during implementation -->
**Implementation Start Date**: [To be filled]
**Developer**: [To be filled]

### Implementation Notes
- [Dev agent to document key decisions, challenges, and solutions]

### Code Review Feedback
- [Code review comments and resolutions]

## QA Results
<!-- QA validation results will be populated here -->
**QA Validation Date**: [To be filled]
**Validated By**: [To be filled]

### Test Execution Summary
- [ ] All acceptance criteria verified
- [ ] Unit tests passing (90%+ coverage)
- [ ] E2E tests passing
- [ ] PostgreSQL MCP validation complete
- [ ] Zero console errors/warnings
- [ ] Performance benchmarks met

### Bugs Found
- [List any bugs discovered during QA]

### Sign-off
- [ ] QA Engineer: [Name]
- [ ] Product Owner: [Name]

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-17 | 1.0 | Story created with space type visual differentiation (Sprint Change Proposal B) | Bob (SM) |
