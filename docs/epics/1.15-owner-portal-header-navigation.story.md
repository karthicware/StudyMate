# Story 1.15: Owner Portal Header & Navigation Component

## Story Metadata

| Field | Value |
|-------|-------|
| **Story ID** | 1.15 |
| **Title** | Owner Portal Header & Navigation Component |
| **Epic** | Epic-1 - Owner Dashboard & Analytics |
| **Feature** | Feature 1.5 - Owner Portal Infrastructure |
| **Priority** | High |
| **Story Points** | 3 |
| **Status** | Ready for Development |
| **Dependencies** | Story 1.14a (Router Test Fix), Epic 0 (Auth & Routing) |
| **Blocks** | Story 1.17 (Layout Shell) |

---

## User Story

**As an** Owner,
**I want** a persistent header with navigation menu
**so that** I can easily access all dashboard features from any page.

---

## Context & Background

The Owner Portal needs a consistent navigation header that:
- Provides quick access to all major features (Dashboard, Seat Map, Users, Reports, Profile, Settings)
- Displays owner identity and study hall context
- Remains visible and accessible across all Owner pages
- Follows the established UI/UX design patterns from Student Portal (Epic 2)

This component will be integrated into the Layout Shell (Story 1.17) and serve as the primary navigation mechanism for the Owner Portal.

---

## Acceptance Criteria

### AC1: Header Structure & Content
- [ ] Header displays the following elements:
  - **Left section:** StudyMate logo (clickable, navigates to dashboard)
  - **Center section:** Study hall name
  - **Right section:** Owner name + avatar, Logout button
- [ ] Header height: 64px (standard app header height)
- [ ] Header background uses primary brand color from Tailwind config
- [ ] All text readable with proper contrast ratios (WCAG AA compliance)

### AC2: Navigation Menu
- [ ] Navigation menu includes the following links (in order):
  1. **Dashboard** → `/owner/dashboard`
  2. **Seat Map** → `/owner/seat-map-config`
  3. **Users** → `/owner/user-management`
  4. **Reports** → `/owner/reports`
  5. **Profile** → `/owner/profile`
  6. **Settings** → `/owner/settings`
- [ ] Each nav item displays icon + label
- [ ] Active route highlighted with different background color
- [ ] Hover state shows interactive feedback

### AC3: Active Route Highlighting
- [ ] Currently active route has visual indicator:
  - Different background color (lighter shade)
  - Border or underline accent
  - Bold text or different text color
- [ ] Uses Angular Router's `routerLinkActive` directive
- [ ] Highlighting updates immediately on route change

### AC4: Responsive Design
- [ ] **Desktop (≥1024px):** Full horizontal menu with all items visible
- [ ] **Tablet (768px-1023px):** Horizontal menu with icons + short labels
- [ ] **Mobile (<768px):** Hamburger menu with slide-out drawer
  - Hamburger icon in top-right
  - Drawer slides from right side
  - Overlay dimming background when open
  - Close button or tap outside to dismiss

### AC5: User Context Display
- [ ] Owner name displayed (from JWT token or user state)
- [ ] Avatar displays:
  - Profile picture if uploaded
  - Initials in colored circle if no picture (e.g., "JD" for John Doe)
  - Default user icon as fallback
- [ ] Study hall name displayed (from user's hall association)
- [ ] Dropdown menu on avatar click showing:
  - Profile link
  - Settings link
  - Logout option

### AC6: Logout Functionality
- [ ] Logout button/option triggers logout flow:
  1. Clear JWT token from storage (localStorage/sessionStorage)
  2. Clear NgRx auth state
  3. Navigate to `/login` route
  4. Show logout success message (toast notification)
- [ ] Logout confirmation modal (optional, based on UX decision)
- [ ] All auth state properly cleared

### AC7: Fixed Header Behavior
- [ ] Header remains fixed at top during page scroll
- [ ] Content below header properly offset (padding-top)
- [ ] Z-index properly configured to stay above page content
- [ ] No header overlap with modals or dropdowns

### AC8: Angular Router Integration
- [ ] All navigation uses Angular Router (no page reloads)
- [ ] Navigation preserves application state
- [ ] Browser back/forward buttons work correctly
- [ ] Deep linking to specific routes works

---

## Tasks / Subtasks

- [ ] Task 1: Create header component structure (AC: 1, 7)
  - [ ] Generate `owner-header` component using Angular CLI
  - [ ] Set up component as standalone with required imports
  - [ ] Create component files (.ts, .html, .scss, .spec.ts)
  - [ ] Configure component selector and metadata
  - [ ] Add component to owner module exports

- [ ] Task 2: Implement header layout and structure (AC: 1, 7)
  - [ ] Create fixed header with 64px height
  - [ ] Implement three-section layout (left, center, right)
  - [ ] Add StudyMate logo to left section with routing link
  - [ ] Add study hall name to center section
  - [ ] Add user avatar and logout button to right section
  - [ ] Apply Tailwind CSS for styling and positioning
  - [ ] Configure z-index for proper layering

- [ ] Task 3: Build navigation menu (AC: 2, 3, 8)
  - [ ] Create navigation items array with paths and icons
  - [ ] Implement navigation links with RouterLink directives
  - [ ] Add routerLinkActive for active route highlighting
  - [ ] Style navigation items with hover states
  - [ ] Add icons to navigation items
  - [ ] Test all 6 navigation routes

- [ ] Task 4: Implement user context display (AC: 5)
  - [ ] Integrate NgRx selectors for user state
  - [ ] Display owner name from auth state
  - [ ] Implement avatar display logic (picture/initials/default)
  - [ ] Add study hall name display
  - [ ] Create avatar dropdown menu
  - [ ] Add profile/settings links to dropdown
  - [ ] Add logout option to dropdown

- [ ] Task 5: Implement logout functionality (AC: 6)
  - [ ] Create logout method in component
  - [ ] Dispatch logout action to NgRx store
  - [ ] Clear JWT token from storage
  - [ ] Navigate to login page
  - [ ] Add toast notification for logout success
  - [ ] Test logout flow end-to-end

- [ ] Task 6: Implement responsive design (AC: 4, 8)
  - [ ] Create desktop layout (≥1024px) with full menu
  - [ ] Create tablet layout (768px-1023px) with compact menu
  - [ ] Create mobile layout (<768px) with hamburger menu
  - [ ] Implement hamburger menu toggle logic
  - [ ] Create slide-out drawer for mobile menu
  - [ ] Add overlay dimming for mobile drawer
  - [ ] Test all breakpoints

- [ ] Task 7: Add accessibility features (AC: 1)
  - [ ] Add ARIA labels to all interactive elements
  - [ ] Ensure keyboard navigation works (Tab order)
  - [ ] Add focus indicators for keyboard users
  - [ ] Use semantic HTML (header, nav tags)
  - [ ] Verify color contrast meets WCAG AA standards
  - [ ] Test with screen reader

- [ ] Task 8: Implement unit tests (AC: All)
  - [ ] Set up test bed with Router mock utilities
  - [ ] Test component renders all navigation items
  - [ ] Test routerLinkActive highlights active route
  - [ ] Test user context displays correctly
  - [ ] Test logout function calls store dispatch
  - [ ] Test mobile menu toggle functionality
  - [ ] Achieve 90%+ code coverage

- [ ] Task 9: Implement Playwright E2E tests (AC: All)
  - [ ] Test header displays on all Owner Portal pages
  - [ ] Test navigation to all 6 sections
  - [ ] Test active route highlighting
  - [ ] Test logout flow
  - [ ] Test responsive behavior at 4 breakpoints
  - [ ] Verify zero console errors
  - [ ] Test browser back/forward navigation

- [ ] Task 10: Integration and polish (AC: All)
  - [ ] Integrate with Layout Shell (Story 1.17)
  - [ ] Verify header works with all route guards
  - [ ] Test with actual NgRx store
  - [ ] Polish styling and animations
  - [ ] Code review and fixes
  - [ ] Documentation updates

---

## Technical Implementation Notes

### Component Structure

**File:** `src/app/owner/components/owner-header/owner-header.component.ts`

```typescript
import { Component, inject, Signal } from '@angular/core';
import { Router, RouterLink, RouterLinkActive } from '@angular/router';
import { Store } from '@ngrx/store';
import { toSignal } from '@angular/core/rxjs-interop';

@Component({
  selector: 'app-owner-header',
  standalone: true,
  imports: [RouterLink, RouterLinkActive, CommonModule],
  templateUrl: './owner-header.component.html',
  styleUrls: ['./owner-header.component.scss']
})
export class OwnerHeaderComponent {
  private store = inject(Store);
  private router = inject(Router);

  // User state from NgRx
  user = toSignal(this.store.select(selectCurrentUser));
  hallName = toSignal(this.store.select(selectUserHallName));

  // Mobile menu state
  mobileMenuOpen = signal(false);

  navItems = [
    { label: 'Dashboard', path: '/owner/dashboard', icon: 'dashboard' },
    { label: 'Seat Map', path: '/owner/seat-map-config', icon: 'map' },
    { label: 'Users', path: '/owner/user-management', icon: 'people' },
    { label: 'Reports', path: '/owner/reports', icon: 'analytics' },
    { label: 'Profile', path: '/owner/profile', icon: 'person' },
    { label: 'Settings', path: '/owner/settings', icon: 'settings' }
  ];

  toggleMobileMenu() {
    this.mobileMenuOpen.update(open => !open);
  }

  logout() {
    // Clear auth state and navigate to login
    this.store.dispatch(authActions.logout());
    this.router.navigate(['/login']);
  }
}
```

### Styling Guidelines

**Use Tailwind CSS for all styling:**
```html
<header class="fixed top-0 left-0 right-0 h-16 bg-primary-600 text-white shadow-md z-50">
  <nav class="flex items-center justify-between px-6 h-full">
    <!-- Logo -->
    <a routerLink="/owner/dashboard" class="flex items-center gap-2">
      <img src="/assets/logo.svg" alt="StudyMate" class="h-8" />
    </a>

    <!-- Navigation (Desktop) -->
    <div class="hidden lg:flex items-center gap-2">
      @for (item of navItems; track item.path) {
        <a
          [routerLink]="item.path"
          routerLinkActive="bg-primary-700 font-semibold"
          class="px-4 py-2 rounded hover:bg-primary-500 transition-colors">
          {{ item.label }}
        </a>
      }
    </div>

    <!-- User section -->
    <div class="flex items-center gap-4">
      <span class="hidden md:inline">{{ hallName() }}</span>
      <button (click)="logout()" class="btn-secondary">Logout</button>
    </div>
  </nav>
</header>
```

### NgRx Selectors Required

Ensure these selectors exist or create them:
```typescript
// auth.selectors.ts
export const selectCurrentUser = createSelector(
  selectAuthState,
  (state) => state.user
);

export const selectUserHallName = createSelector(
  selectCurrentUser,
  (user) => user?.hallName || 'Study Hall'
);
```

### Accessibility Requirements

- [ ] All interactive elements keyboard accessible (Tab navigation)
- [ ] Focus indicators visible
- [ ] ARIA labels for icon-only buttons
- [ ] Semantic HTML (`<header>`, `<nav>` tags)
- [ ] Color contrast meets WCAG AA standards (4.5:1 for normal text)

---

## Testing Requirements

### Unit Tests (Jasmine/Karma)

**File:** `owner-header.component.spec.ts`

```typescript
describe('OwnerHeaderComponent', () => {
  it('should display all navigation items', () => {
    // Test that all 6 nav items render
  });

  it('should highlight active route', () => {
    // Test routerLinkActive directive
  });

  it('should display user name and hall name', () => {
    // Test user context display
  });

  it('should call logout on logout button click', () => {
    // Test logout functionality
  });

  it('should toggle mobile menu', () => {
    // Test mobile menu open/close
  });
});
```

**Use Router mock utilities from Story 1.14a:**
```typescript
import { provideRouterMock } from '@/testing/router-test-utils';

TestBed.configureTestingModule({
  imports: [OwnerHeaderComponent],
  providers: [
    provideRouterMock(),
    provideMockStore({ selectors: [...] })
  ]
});
```

### Playwright E2E Tests

**File:** `e2e/owner-header.spec.ts`

```typescript
test.describe('Owner Header Navigation', () => {
  test.beforeEach(async ({ page }) => {
    // Login as owner
    await loginAsOwner(page);
    await page.goto('/owner/dashboard');
  });

  test('should display header with all navigation items', async ({ page }) => {
    await expect(page.locator('header')).toBeVisible();
    await expect(page.locator('nav a')).toHaveCount(6);
  });

  test('should navigate to each section', async ({ page }) => {
    await page.click('text=Seat Map');
    await expect(page).toHaveURL(/\/owner\/seat-map-config/);

    await page.click('text=Users');
    await expect(page).toHaveURL(/\/owner\/user-management/);

    // Test all other nav items...
  });

  test('should highlight active route', async ({ page }) => {
    await page.click('text=Profile');
    const profileLink = page.locator('a[routerLink="/owner/profile"]');
    await expect(profileLink).toHaveClass(/bg-primary-700/);
  });

  test('should logout successfully', async ({ page }) => {
    await page.click('text=Logout');
    await expect(page).toHaveURL(/\/login/);

    // Verify can't access protected route after logout
    await page.goto('/owner/dashboard');
    await expect(page).toHaveURL(/\/login/);
  });

  test('should work responsively on mobile', async ({ page }) => {
    await page.setViewportSize({ width: 375, height: 667 });

    // Hamburger menu should be visible
    await expect(page.locator('[aria-label="Menu"]')).toBeVisible();

    // Desktop menu should be hidden
    await expect(page.locator('nav.desktop-menu')).toBeHidden();
  });

  test('should have zero console errors', async ({ page }) => {
    const errors = [];
    page.on('console', msg => {
      if (msg.type() === 'error') errors.push(msg.text());
    });

    await page.goto('/owner/dashboard');
    expect(errors).toEqual([]);
  });
});
```

### Responsive Testing

Test at these breakpoints:
- [ ] Mobile: 375px (iPhone SE)
- [ ] Tablet: 768px (iPad)
- [ ] Desktop: 1024px (Standard laptop)
- [ ] Large: 1440px (Desktop monitor)

---

## Definition of Done

### Implementation
- [ ] Component created with all acceptance criteria met
- [ ] All 6 navigation items functional
- [ ] Active route highlighting working
- [ ] Logout functionality working
- [ ] Responsive design validated at 4 breakpoints

### Testing
- [ ] Unit tests passing (90%+ code coverage)
- [ ] Playwright E2E tests passing (all scenarios)
- [ ] Tested in Chrome, Firefox, Safari
- [ ] Zero browser console errors/warnings
- [ ] Accessibility audit passing (Lighthouse score ≥90)

### Code Quality
- [ ] Code reviewed and approved
- [ ] Follows Angular 20 coding standards
- [ ] Uses Signals and standalone components
- [ ] Proper TypeScript typing (no `any` types)
- [ ] Tailwind CSS used for all styling (no inline styles)

### Documentation
- [ ] Component documented with JSDoc comments
- [ ] Usage examples provided
- [ ] Integration with Layout Shell documented

---

## References

- **Context7 MCP Queries:**
  - `"use context7 - Angular 20 standalone components best practices"`
  - `"use context7 - Angular 20 RouterLinkActive directive"`
  - `"use context7 - Angular 20 Signals toSignal()"`
- **Design Reference:** Epic 2 Student Portal Header (for consistency)
- **Coding Standards:** [docs/guidelines/coding-standard-guidelines/angular-rules.md](../guidelines/coding-standard-guidelines/angular-rules.md)
- **UI/UX Standards:** [docs/guidelines/coding-standard-guidelines/ui-ux-design-best-practices.md](../guidelines/coding-standard-guidelines/ui-ux-design-best-practices.md)

---

## Assets Required

- [ ] StudyMate logo (SVG format)
- [ ] Navigation icons (Material Icons or custom SVG)
- [ ] Default user avatar placeholder
- [ ] Favicon for browser tab

---

## Estimated Effort

| Task | Estimated Time |
|------|----------------|
| Component implementation | 3 hours |
| Responsive design | 2 hours |
| NgRx integration | 1 hour |
| Unit tests | 2 hours |
| Playwright E2E tests | 2 hours |
| Styling & polish | 1 hour |
| Code review & fixes | 1 hour |
| **Total** | **~12 hours (3 SP)** |

---

## Story Completion Checklist

- [ ] All acceptance criteria met (AC1-AC8)
- [ ] Component implemented and functional
- [ ] All tests passing (unit + E2E)
- [ ] Responsive design validated
- [ ] Code reviewed and approved
- [ ] Zero console errors/warnings
- [ ] Accessibility validated
- [ ] Ready for integration in Story 1.17

---

**Status:** Ready for Development
**Dependencies:** Must complete Story 1.14a first (Router test fix)
**Next:** Story 1.16 (Footer Component) can run in parallel

---

## Dev Notes

### Previous Story Insights

**Story 1.14a** established Router test utilities and patterns that must be used:
- Use `provideRouterMock()` from `@/testing/router-test-utils` for unit tests
- All Router testing configurations now standardized
- Zero Router-related test failures required before this story begins

**Story 1.1** (Dashboard) provides UI/UX patterns to follow:
- Consistent color palette and shadow layering
- Tailwind CSS utility classes for all styling
- Angular Signals for reactive state management

**Key Learning:** Header navigation is critical infrastructure - must be thoroughly tested and accessible.

### Architecture Overview

[Source: docs/architecture/studymate-system-architecture-blueprint.md#1-technology-stack--environment]
- **Frontend**: Angular 20 with TypeScript, NgRx (State Management), Signals
- **Styling**: Tailwind CSS (utility-first CSS framework)
- **Routing**: Angular Router with standalone components
- **State Management**: NgRx Store for auth state

### Angular Development Standards

[Source: docs/guidelines/coding-standard-guidelines/angular-rules.md]
- Use standalone components with `inject()` function for service injection
- Implement Angular Signals for reactive state management
- Use `toSignal()` for converting Observables to Signals
- Follow kebab-case naming for files (e.g., `owner-header.component.ts`)
- Use 2-space indentation and single quotes for strings
- Import order: Angular core → RxJS → Angular-specific → App core → Shared → Environment → Relative paths

### UI/UX Design Standards

[Source: docs/guidelines/coding-standard-guidelines/ui-ux-design-best-practices.md]
- **Header Height**: 64px (standard app header height)
- **Color Palette**: Primary brand color for header background
- **Navigation States**:
  - Default: Subtle background
  - Hover: Lighter/darker background with transition
  - Active: Distinct background + border/underline
- **Shadow System**: Medium shadow for header (depth/elevation)
- **WCAG Compliance**: Color contrast ratio ≥ 4.5:1 for text

### Navigation Structure

**Owner Portal Routes** (must match these exactly):
1. `/owner/dashboard` - Dashboard Overview
2. `/owner/seat-map-config` - Seat Map Configuration
3. `/owner/user-management` - User Management
4. `/owner/reports` - Reports & Analytics
5. `/owner/profile` - Owner Profile (Story 1.18)
6. `/owner/settings` - Owner Settings (Story 1.20)

### File Locations

**Component Files:**
- `studymate-frontend/src/app/owner/components/owner-header/owner-header.component.ts`
- `studymate-frontend/src/app/owner/components/owner-header/owner-header.component.html`
- `studymate-frontend/src/app/owner/components/owner-header/owner-header.component.scss`
- `studymate-frontend/src/app/owner/components/owner-header/owner-header.component.spec.ts`

**NgRx Selectors** (verify or create):
- `studymate-frontend/src/app/store/auth/auth.selectors.ts`
  - `selectCurrentUser`
  - `selectUserHallName`
  - `selectIsAuthenticated`

**Assets:**
- `studymate-frontend/src/assets/logo.svg` (StudyMate logo)
- `studymate-frontend/src/assets/icons/` (Navigation icons)

### Testing Requirements

[Source: docs/architecture/studymate-system-architecture-blueprint.md#5-testing-architecture--quality-assurance]

#### Unit Testing
- **Framework**: Jasmine/Karma (Angular default)
- **Pattern**: Arrange-Act-Assert
- **Coverage**: 90%+ required
- **Focus**: Component rendering, navigation logic, NgRx integration, responsive behavior

#### End-to-End Testing
[Source: docs/guidelines/coding-standard-guidelines/playwright-rules.md]
- **Framework**: Playwright
- **Requirements**:
  - Test complete navigation workflows
  - Verify zero browser console errors/warnings
  - Test responsive behavior at all breakpoints
  - Test authentication integration
- **Location**: `studymate-frontend/e2e/owner-header.spec.ts`

### Technical Constraints

- **Performance**: Header must render within 100ms
- **Responsive Breakpoints**:
  - Mobile: <768px
  - Tablet: 768px-1023px
  - Desktop: ≥1024px
- **Browser Support**: Chrome, Firefox, Safari (latest 2 versions)
- **Accessibility**: Lighthouse accessibility score ≥ 90

### context7 MCP Integration (MANDATORY)

[Source: docs/architecture/studymate-system-architecture-blueprint.md#context7-mcp-integration-mandatory]
- **Pre-Implementation**: ALWAYS consult context7 before writing code for latest patterns
- **Required Queries**:
  - `"use context7 - Angular 20 standalone components best practices"`
  - `"use context7 - Angular 20 RouterLinkActive directive"`
  - `"use context7 - Angular 20 Signals toSignal()"`
- **Usage**: Verify all Angular 20 patterns against official documentation

### Integration Notes

**Story 1.17 Integration:**
- This component will be imported into Layout Shell (Story 1.17)
- Header must be standalone and independently testable
- No dependencies on Layout Shell for testing

**NgRx Store Integration:**
- Requires auth store to be configured (Epic 0)
- Uses selectors for user data and authentication state
- Dispatches logout action on user logout

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-12 | 1.0 | Story created for Owner Portal Header & Navigation | Bob (Scrum Master) |
| 2025-10-12 | 1.1 | Added Tasks/Subtasks and Dev Notes sections | Bob (Scrum Master) |

---

## Dev Agent Record

### Agent Model Used
_To be filled by Dev Agent_

### Debug Log References
_To be filled by Dev Agent_

### Completion Notes List
_To be filled by Dev Agent during implementation:_
- Document navigation structure decisions
- Note any NgRx selector additions/modifications
- Describe responsive design approach
- List any asset files created/required
- Document accessibility testing results
- Note any deviations from technical specs

### File List

**Files to Create:**
- `studymate-frontend/src/app/owner/components/owner-header/owner-header.component.ts`
- `studymate-frontend/src/app/owner/components/owner-header/owner-header.component.html`
- `studymate-frontend/src/app/owner/components/owner-header/owner-header.component.scss`
- `studymate-frontend/src/app/owner/components/owner-header/owner-header.component.spec.ts`
- `studymate-frontend/e2e/owner-header.spec.ts`

**Files to Modify:**
- `studymate-frontend/src/app/store/auth/auth.selectors.ts` (add selectors if missing)
- `studymate-frontend/src/app/store/auth/auth.actions.ts` (verify logout action exists)

**Assets Required:**
- StudyMate logo (SVG)
- Navigation icons (Material Icons or SVG)
- Default user avatar placeholder

---

## QA Results

_To be filled by QA Agent_
