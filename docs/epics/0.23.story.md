# Story 0.23: Create Angular Auth Service and Guards

## Status
Draft

## Story
**As a** Developer,
**I want** Angular authentication service and route guards,
**so that** frontend can authenticate users and protect routes.

## Acceptance Criteria
1. AuthService created with login/register/logout methods
2. JWT token stored securely in localStorage
3. AuthGuard created to protect routes
4. HTTP interceptor adds JWT to requests
5. Login/register components created
6. Authentication state managed with signals

## Tasks / Subtasks
- [ ] Task 1: Create AuthService (AC: 1)
  - [ ] Create src/app/core/services/auth.service.ts
  - [ ] Implement login method calling POST /api/auth/login
  - [ ] Implement register method
  - [ ] Implement logout method
  - [ ] Use HttpClient for API calls
- [ ] Task 2: Implement token storage (AC: 2)
  - [ ] Store token in localStorage on login
  - [ ] Remove token on logout
  - [ ] Create getToken method
  - [ ] Create isAuthenticated signal
- [ ] Task 3: Create AuthGuard (AC: 3)
  - [ ] Create src/app/core/guards/auth.guard.ts
  - [ ] Implement CanActivate interface
  - [ ] Check authentication status
  - [ ] Redirect to login if not authenticated
- [ ] Task 4: Create HTTP interceptor (AC: 4)
  - [ ] Create src/app/core/interceptors/auth.interceptor.ts
  - [ ] Add Authorization header with token
  - [ ] Handle 401 responses
  - [ ] Provide in app.config.ts
- [ ] Task 5: Create login component (AC: 5)
  - [ ] Create login component with reactive form
  - [ ] Add email and password fields
  - [ ] Call AuthService.login on submit
  - [ ] Handle errors
  - [ ] Navigate to dashboard on success
- [ ] Task 6: Create register component (AC: 5)
  - [ ] Create register component
  - [ ] Add form fields (email, password, firstName, etc.)
  - [ ] Call AuthService.register
  - [ ] Handle validation errors
- [ ] Task 7: Manage auth state with signals (AC: 6)
  - [ ] Create auth store using NgRx Signals
  - [ ] Store current user
  - [ ] Store authentication status
  - [ ] Update on login/logout

## Dev Notes

### AuthService
```typescript
@Injectable({ providedIn: 'root' })
export class AuthService {
  private http = inject(HttpClient);
  private router = inject(Router);

  isAuthenticated = signal(false);
  currentUser = signal<User | null>(null);

  login(credentials: LoginRequest): Observable<AuthResponse> {
    return this.http.post<AuthResponse>('/api/auth/login', credentials)
      .pipe(tap(response => {
        localStorage.setItem('token', response.token);
        this.isAuthenticated.set(true);
      }));
  }

  logout() {
    localStorage.removeItem('token');
    this.isAuthenticated.set(false);
    this.router.navigate(['/login']);
  }
}
```

### AuthGuard
```typescript
export const authGuard: CanActivateFn = (route, state) => {
  const authService = inject(AuthService);
  const router = inject(Router);

  if (authService.isAuthenticated()) {
    return true;
  }

  router.navigate(['/login']);
  return false;
};
```

## Testing
- Test AuthService methods
- Test AuthGuard redirects
- Test HTTP interceptor adds token
- E2E test login flow

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-10 | 1.0 | Story created from Epic 0, Feature 0.5 | Bob (Scrum Master) |
