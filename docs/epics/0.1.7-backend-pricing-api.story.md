# Story 0.1.7-backend: Pricing Management API (Backend)

## Status
Ready for development

## Story
**As a** backend system,
**I want** to provide APIs for updating hall pricing,
**so that** owners can set base pricing during onboarding.

## Acceptance Criteria

### AC1: PUT /owner/halls/{hallId}/pricing updates base pricing
**Given** authenticated owner sends PUT to `/owner/halls/{hallId}/pricing`
**When** request includes valid basePricing (₹50 - ₹5000)
**Then** the system:
- Validates hallId exists and belongs to owner
- Updates base_pricing column in study_halls table
- Sets updated_at timestamp
- Returns 200 OK with updated hall pricing

### AC2: Pricing validation enforced
**Given** owner sends invalid pricing
**When** basePricing < ₹50 or > ₹5000
**Then** the system returns 400 Bad Request with error message

### AC3: Owner authorization enforced
**Given** request to update pricing
**When** hallId does not belong to authenticated owner
**Then** the system returns 403 Forbidden

## Tasks / Subtasks

### Task 1: Create PricingUpdateRequest DTO (AC: 1, 2)
- [ ] Create `PricingUpdateRequest.java`:
  - basePricing (BigDecimal, @NotNull, @Min(50), @Max(5000))

### Task 2: Update HallService (AC: 1, 2, 3)
- [ ] Implement `updatePricing(UUID hallId, UUID ownerId, PricingUpdateRequest request): HallResponse`
- [ ] Verify hall exists: `findById(hallId)`
- [ ] Verify owner: `hall.getOwnerId().equals(ownerId)`
- [ ] Throw `ForbiddenException` if not owner
- [ ] Update base_pricing field
- [ ] Update updated_at timestamp
- [ ] Save to database
- [ ] Return HallResponse

### Task 3: Update HallController (AC: 1)
- [ ] Add PUT endpoint: `/owner/halls/{hallId}/pricing`
- [ ] `@PreAuthorize("hasRole('OWNER')")`
- [ ] Extract ownerId from JWT
- [ ] Call `hallService.updatePricing()`
- [ ] Return 200 OK with HallResponse

### Task 4: Testing (AC: All)
- [ ] Unit tests: service layer, controller layer
- [ ] Integration tests: end-to-end pricing update
- [ ] PostgreSQL MCP validation

## Dev Notes

### Database Update
No migration needed - `base_pricing` column already exists in study_halls table (created in Story 0.1.6-backend).

### Validation
- Min: 50 (₹50)
- Max: 5000 (₹5000)
- Type: BigDecimal (supports decimal pricing like ₹150.50)

### File Locations
- DTO: `studymate-backend/src/main/java/com/studymate/dto/PricingUpdateRequest.java`
- Service: Update `HallService.java` (add updatePricing method)
- Controller: Update `HallController.java` (add PUT endpoint)

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-19 | 1.0 | Story created from Epic 0.1, Feature 0.1.7 | Sarah (PO) |

## Dev Agent Record
_To be filled by Dev Agent_

## QA Results
_To be filled by QA Agent_
