# Story 2.16.1: Ladies-Only Seat Visual Styling in Student Booking View

## Story Metadata

| Field | Value |
|-------|-------|
| **Story ID** | 2.16.1 |
| **Story Name** | Ladies-Only Seat Visual Styling in Student Booking View |
| **Epic** | Epic 2: Student Booking & Seat Management |
| **Feature** | Feature 2.16: Seat Selection & Visualization (Enhancement) |
| **Story Type** | Frontend Development |
| **Priority** | High (Phase 3 of Ladies-Only Implementation) |
| **Status** | Draft |
| **Estimated Story Points** | 2 SP |
| **Sprint** | TBD (Phase 3 of Ladies-Only Implementation) |
| **Assigned To** | Unassigned |
| **Created Date** | 2025-10-14 |
| **Updated Date** | 2025-10-14 |
| **Related Change Proposal** | Sprint Change Proposal A: Ladies-Only Seats (SCP-2025-10-14-001) |

---

## User Story

**As a** Student,
**I want** to see ladies-only seats visually distinguished with pink styling and a female symbol
**so that** I can easily identify which seats have gender restrictions before attempting to book.

---

## Story Description

This story ensures that students see the same visual styling for ladies-only seats as owners do. The seat map in the student booking view displays ladies-only seats with a pink background (#FFC0CB), dark pink border (#FF69B4), and a female symbol ♀ in the top-right corner. This provides clear visual feedback about seat restrictions before students attempt to book.

**Context**:
- Part of Sprint Change Proposal A: Ladies-Only Seats Configuration
- Depends on Story 1.4.1 (Ladies-Only Seat Configuration) being complete
- Provides visual feedback before validation errors occur (Story 2.18.1)
- Student-facing enhancement to booking UX

**Dependencies**:
- Story 1.4.1 MUST be complete (ladies-only seat data available via API)
- Seat availability API returns `isLadiesOnly` field
- Student seat map component exists

[Source: Sprint Change Proposal A, Section 8 - Phase 3]

---

## Acceptance Criteria

### AC1: Ladies-Only Seats Display Pink Background
**Given** a student is viewing available seats for booking
**When** the seat map loads
**Then** the system displays:
- Ladies-only seats with pink background color (#FFC0CB)
- Dark pink border (2px solid #FF69B4)
- Visual distinction from regular available seats (green #22c55e)

**Testing**:
- [ ] Ladies-only seats have pink background
- [ ] Regular seats remain green (available) or red (booked)
- [ ] Border styling applied correctly
- [ ] Visual distinction clear in different screen sizes

[Source: Sprint Change Proposal A, Section 6 - Seat Map Styling]

---

### AC2: Female Symbol Displays in Top-Right Corner
**Given** a seat is marked as ladies-only
**When** the seat is rendered in the student booking view
**Then** the system displays:
- Female symbol ♀ in top-right corner of seat
- Symbol color: Deep pink (#FF1493)
- Font size: 12px
- Font weight: bold
- Position: absolute (top: 2px, right: 2px)

**Testing**:
- [ ] Female symbol visible on ladies-only seats
- [ ] Symbol positioned correctly in all seat sizes
- [ ] Symbol color matches design specification
- [ ] Symbol does not overlap seat number

[Source: Sprint Change Proposal A, Section 6 - Seat Map Styling]

---

### AC3: Styling Works Across All Seat Statuses
**Given** a ladies-only seat can be available, booked, or locked
**When** the seat is displayed in the booking view
**Then** the system:
- Applies ladies-only pink styling for AVAILABLE ladies-only seats
- Applies booked styling (red) for BOOKED ladies-only seats
- Applies locked styling (gray) for LOCKED ladies-only seats
- Always shows female symbol ♀ regardless of status

**Status Priority**:
1. Booked status (red) takes visual precedence
2. Locked status (gray) takes precedence over available
3. Ladies-only pink only shown for available ladies-only seats
4. Female symbol ♀ always visible

**Testing**:
- [ ] Available ladies-only seats show pink with female symbol
- [ ] Booked ladies-only seats show red with female symbol
- [ ] Locked ladies-only seats show gray with female symbol
- [ ] Female symbol always visible regardless of status

[Source: Sprint Change Proposal A, Section 6 - Seat Map Styling]

---

### AC4: Seat Map Component Receives `isLadiesOnly` Data
**Given** the student booking view fetches seat availability
**When** the API response includes seat data
**Then** the system:
- Parses `isLadiesOnly` field from API response
- Maps field to Seat model interface
- Passes data to seat rendering logic
- Handles missing/null `isLadiesOnly` values (default: false)

**API Response Example**:
```json
{
  "seats": [
    {
      "id": "uuid",
      "seatNumber": "A1",
      "status": "AVAILABLE",
      "xCoord": 100,
      "yCoord": 150,
      "isLadiesOnly": true,
      "customPrice": 150
    }
  ]
}
```

**Testing**:
- [ ] Component receives isLadiesOnly from API
- [ ] Null/undefined values default to false
- [ ] Seat model includes isLadiesOnly property
- [ ] Type safety enforced in TypeScript

[Source: Sprint Change Proposal A, Section 6 - API Changes]

---

### AC5: CSS Styling Does Not Conflict with Existing Styles
**Given** the seat map has existing status-based styling
**When** ladies-only styling is applied
**Then** the system:
- Does not break existing seat status styles
- Correctly prioritizes status over ladies-only styling
- Maintains hover effects for available seats
- Maintains click handlers for seat selection

**CSS Specificity**:
- `.seat-booked` > `.seat-ladies-only` (booked takes priority)
- `.seat-locked` > `.seat-ladies-only` (locked takes priority)
- `.seat-ladies-only` applied only to available seats

**Testing**:
- [ ] Existing seat styles unaffected
- [ ] Status-based styling takes priority
- [ ] Hover effects work correctly
- [ ] Click handlers functional
- [ ] No CSS conflicts or console errors

[Source: Sprint Change Proposal A, Section 6 - Frontend Changes]

---

## Technical Implementation Details

### Frontend Implementation

**1. Seat Model Update (Already done in Story 1.4.1)**

File: `studymate-frontend/src/app/core/models/seat.model.ts`
```typescript
export interface Seat {
  id: string;
  hallId: string;
  seatNumber: string;
  xCoord: number;
  yCoord: number;
  status: 'available' | 'booked' | 'locked' | 'maintenance';
  customPrice?: number;
  isLadiesOnly?: boolean;  // Already added in Story 1.4.1
  createdAt: Date;
  updatedAt: Date;
}
```

**2. Student Seat Map Component Logic Update**

File: `studymate-frontend/src/app/features/student/seat-selection/seat-selection.component.ts`
```typescript
import { Component, OnInit, inject } from '@angular/core';
import { CommonModule } from '@angular/common';
import { BookingService } from '@core/services/booking.service';
import { Seat } from '@core/models/seat.model';

@Component({
  selector: 'app-seat-selection',
  standalone: true,
  imports: [CommonModule],
  templateUrl: './seat-selection.component.html',
  styleUrls: ['./seat-selection.component.scss']
})
export class SeatSelectionComponent implements OnInit {
  private bookingService = inject(BookingService);

  seats: Seat[] = [];
  selectedSeat: Seat | null = null;

  ngOnInit(): void {
    this.loadSeats();
  }

  loadSeats(): void {
    const hallId = this.getHallIdFromRoute();
    this.bookingService.getAvailableSeats(hallId).subscribe({
      next: (seats) => {
        this.seats = seats;
      },
      error: (error) => {
        console.error('Failed to load seats:', error);
      }
    });
  }

  /**
   * Get CSS classes for a seat based on its status and ladies-only flag
   */
  getSeatClasses(seat: Seat): string[] {
    const classes = ['seat'];

    // Status-based styling (takes priority)
    if (seat.status === 'booked') {
      classes.push('seat-booked');
    } else if (seat.status === 'locked') {
      classes.push('seat-locked');
    } else if (seat.status === 'maintenance') {
      classes.push('seat-maintenance');
    } else if (seat.status === 'available') {
      classes.push('seat-available');

      // NEW: Ladies-only styling (only for available seats)
      if (seat.isLadiesOnly) {
        classes.push('seat-ladies-only');
      }
    }

    // Always add ladies-only indicator class if flag is true
    // (for female symbol display regardless of status)
    if (seat.isLadiesOnly) {
      classes.push('has-ladies-only-indicator');
    }

    return classes;
  }

  selectSeat(seat: Seat): void {
    if (seat.status === 'available') {
      this.selectedSeat = seat;
      // Gender validation will be handled in Story 2.18.1
    }
  }

  private getHallIdFromRoute(): string {
    // Implementation to extract hallId from route params
    return '';
  }
}
```

**3. Student Seat Map Component Template**

File: `studymate-frontend/src/app/features/student/seat-selection/seat-selection.component.html`
```html
<div class="seat-map-container">
  <h2 class="text-2xl font-bold mb-4">Select Your Seat</h2>

  <!-- Seat Legend -->
  <div class="seat-legend mb-6 flex gap-4">
    <div class="legend-item flex items-center gap-2">
      <div class="seat seat-available w-8 h-8"></div>
      <span class="text-sm">Available</span>
    </div>
    <div class="legend-item flex items-center gap-2">
      <div class="seat seat-booked w-8 h-8"></div>
      <span class="text-sm">Booked</span>
    </div>
    <div class="legend-item flex items-center gap-2">
      <div class="seat seat-locked w-8 h-8"></div>
      <span class="text-sm">Locked</span>
    </div>
    <!-- NEW: Ladies-only legend -->
    <div class="legend-item flex items-center gap-2">
      <div class="seat seat-available seat-ladies-only has-ladies-only-indicator w-8 h-8"></div>
      <span class="text-sm">Ladies Only</span>
    </div>
  </div>

  <!-- Seat Map Grid -->
  <div class="seat-map-grid relative">
    @for (seat of seats; track seat.id) {
      <div
        [attr.data-seat]="seat.seatNumber"
        [ngClass]="getSeatClasses(seat)"
        [style.left.px]="seat.xCoord"
        [style.top.px]="seat.yCoord"
        (click)="selectSeat(seat)"
        [attr.title]="seat.isLadiesOnly ? 'Ladies Only - ' + seat.seatNumber : seat.seatNumber"
      >
        <span class="seat-number">{{ seat.seatNumber }}</span>
      </div>
    }
  </div>

  <!-- Selected Seat Info -->
  @if (selectedSeat) {
    <div class="selected-seat-info mt-6 p-4 bg-blue-50 rounded-lg">
      <p class="text-lg font-semibold">Selected: {{ selectedSeat.seatNumber }}</p>
      @if (selectedSeat.isLadiesOnly) {
        <p class="text-sm text-pink-600 mt-1">
          ♀ Ladies Only Seat
        </p>
      }
      <button class="mt-4 px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
        Proceed to Booking
      </button>
    </div>
  }
</div>
```

**4. Student Seat Map Component Styling**

File: `studymate-frontend/src/app/features/student/seat-selection/seat-selection.component.scss`
```scss
.seat-map-container {
  padding: 24px;
}

.seat-map-grid {
  position: relative;
  width: 100%;
  height: 600px;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  background-color: #f9fafb;
}

.seat {
  position: absolute;
  width: 40px;
  height: 40px;
  border: 1px solid #ccc;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
  font-size: 12px;
  font-weight: 600;

  &:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  // Status-based styling
  &.seat-available {
    background-color: #22c55e; // Green
    color: white;
    cursor: pointer;

    &:hover {
      background-color: #16a34a;
    }
  }

  &.seat-booked {
    background-color: #ef4444; // Red
    color: white;
    cursor: not-allowed;

    &:hover {
      transform: none;
      box-shadow: none;
    }
  }

  &.seat-locked {
    background-color: #9ca3af; // Gray
    color: white;
    cursor: not-allowed;

    &:hover {
      transform: none;
      box-shadow: none;
    }
  }

  &.seat-maintenance {
    background-color: #f59e0b; // Orange
    color: white;
    cursor: not-allowed;
  }

  // NEW: Ladies-only styling (only for available seats)
  &.seat-ladies-only {
    background-color: #FFC0CB !important; // Pink
    border: 2px solid #FF69B4; // Dark pink
    color: #1f2937; // Dark gray text for better contrast

    &:hover {
      background-color: #FFB6C1 !important; // Slightly darker pink
    }
  }

  // NEW: Female symbol indicator (shown for all ladies-only seats regardless of status)
  &.has-ladies-only-indicator {
    &::after {
      content: '♀';
      position: absolute;
      top: 2px;
      right: 2px;
      font-size: 12px;
      color: #FF1493; // Deep pink
      font-weight: bold;
      z-index: 10;
    }
  }

  .seat-number {
    position: relative;
    z-index: 5;
  }
}

.seat-legend {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
  padding: 16px;
  background-color: white;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);

  .legend-item {
    display: flex;
    align-items: center;
    gap: 8px;

    .seat {
      pointer-events: none;
      cursor: default;

      &:hover {
        transform: none;
        box-shadow: none;
      }
    }
  }
}

.selected-seat-info {
  animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
```

[Source: Sprint Change Proposal A, Section 6 - Frontend Changes]

---

## Testing Requirements

### Frontend Unit Tests

**Component Tests**:
```typescript
describe('SeatSelectionComponent', () => {
  let component: SeatSelectionComponent;
  let fixture: ComponentFixture<SeatSelectionComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [SeatSelectionComponent]
    }).compileComponents();

    fixture = TestBed.createComponent(SeatSelectionComponent);
    component = fixture.componentInstance;
  });

  it('should apply ladies-only styling to available ladies-only seats', () => {
    const seat: Seat = {
      id: '1',
      hallId: 'hall-1',
      seatNumber: 'A1',
      xCoord: 100,
      yCoord: 150,
      status: 'available',
      isLadiesOnly: true,
      createdAt: new Date(),
      updatedAt: new Date()
    };

    const classes = component.getSeatClasses(seat);

    expect(classes).toContain('seat-available');
    expect(classes).toContain('seat-ladies-only');
    expect(classes).toContain('has-ladies-only-indicator');
  });

  it('should show booked styling for booked ladies-only seats', () => {
    const seat: Seat = {
      id: '2',
      hallId: 'hall-1',
      seatNumber: 'A2',
      xCoord: 200,
      yCoord: 150,
      status: 'booked',
      isLadiesOnly: true,
      createdAt: new Date(),
      updatedAt: new Date()
    };

    const classes = component.getSeatClasses(seat);

    expect(classes).toContain('seat-booked');
    expect(classes).not.toContain('seat-ladies-only');
    expect(classes).toContain('has-ladies-only-indicator'); // Female symbol still shown
  });

  it('should not apply ladies-only styling to regular available seats', () => {
    const seat: Seat = {
      id: '3',
      hallId: 'hall-1',
      seatNumber: 'B1',
      xCoord: 100,
      yCoord: 200,
      status: 'available',
      isLadiesOnly: false,
      createdAt: new Date(),
      updatedAt: new Date()
    };

    const classes = component.getSeatClasses(seat);

    expect(classes).toContain('seat-available');
    expect(classes).not.toContain('seat-ladies-only');
    expect(classes).not.toContain('has-ladies-only-indicator');
  });

  it('should handle missing isLadiesOnly field', () => {
    const seat: Seat = {
      id: '4',
      hallId: 'hall-1',
      seatNumber: 'C1',
      xCoord: 100,
      yCoord: 250,
      status: 'available',
      // isLadiesOnly not provided
      createdAt: new Date(),
      updatedAt: new Date()
    };

    const classes = component.getSeatClasses(seat);

    expect(classes).toContain('seat-available');
    expect(classes).not.toContain('seat-ladies-only');
    expect(classes).not.toContain('has-ladies-only-indicator');
  });
});
```

### E2E Tests (Playwright)

**E2E Test Suite**:
```typescript
import { test, expect } from '@playwright/test';

test.describe('Ladies-Only Seat Styling in Student View', () => {
  test.beforeEach(async ({ page }) => {
    // Login as student
    await page.goto('/login');
    await page.fill('input[name="email"]', 'student@example.com');
    await page.fill('input[name="password"]', 'password123');
    await page.click('button[type="submit"]');

    // Navigate to seat selection
    await page.goto('/student/seat-selection?hallId=test-hall-1');
    await page.waitForSelector('.seat-map-grid');
  });

  test('ladies-only seats display with pink background', async ({ page }) => {
    const ladiesOnlySeat = page.locator('[data-seat="A1"]');
    await expect(ladiesOnlySeat).toHaveClass(/seat-ladies-only/);

    // Check computed styles
    const backgroundColor = await ladiesOnlySeat.evaluate(
      (el) => window.getComputedStyle(el).backgroundColor
    );
    expect(backgroundColor).toBe('rgb(255, 192, 203)'); // #FFC0CB
  });

  test('ladies-only seats display female symbol', async ({ page }) => {
    const ladiesOnlySeat = page.locator('[data-seat="A1"]');

    // Check for female symbol via ::after pseudo-element
    const hasIndicator = await ladiesOnlySeat.evaluate((el) => {
      const afterContent = window.getComputedStyle(el, '::after').content;
      return afterContent.includes('♀');
    });

    expect(hasIndicator).toBe(true);
  });

  test('booked ladies-only seats show red with female symbol', async ({ page }) => {
    const bookedLadiesSeat = page.locator('[data-seat="A2"]'); // Assume A2 is booked

    await expect(bookedLadiesSeat).toHaveClass(/seat-booked/);
    await expect(bookedLadiesSeat).toHaveClass(/has-ladies-only-indicator/);

    const backgroundColor = await bookedLadiesSeat.evaluate(
      (el) => window.getComputedStyle(el).backgroundColor
    );
    expect(backgroundColor).toBe('rgb(239, 68, 68)'); // Red #ef4444
  });

  test('regular available seats do not have ladies-only styling', async ({ page }) => {
    const regularSeat = page.locator('[data-seat="B1"]');

    await expect(regularSeat).toHaveClass(/seat-available/);
    await expect(regularSeat).not.toHaveClass(/seat-ladies-only/);
    await expect(regularSeat).not.toHaveClass(/has-ladies-only-indicator/);
  });

  test('seat legend includes ladies-only example', async ({ page }) => {
    const legend = page.locator('.seat-legend');
    await expect(legend).toContainText('Ladies Only');

    const ladiesOnlyLegendItem = legend.locator('.seat-ladies-only').first();
    await expect(ladiesOnlyLegendItem).toBeVisible();
  });

  test('hover effect works on ladies-only seats', async ({ page }) => {
    const ladiesOnlySeat = page.locator('[data-seat="A1"]');

    await ladiesOnlySeat.hover();

    // Check transform is applied on hover
    const transform = await ladiesOnlySeat.evaluate(
      (el) => window.getComputedStyle(el).transform
    );
    expect(transform).not.toBe('none');
  });
});
```

### Visual Regression Tests

**Visual Testing**:
```typescript
test('ladies-only seat styling matches design', async ({ page }) => {
  await page.goto('/student/seat-selection?hallId=test-hall-1');
  await page.waitForSelector('.seat-map-grid');

  // Take screenshot of seat map
  await expect(page.locator('.seat-map-grid')).toHaveScreenshot('seat-map-with-ladies-only.png', {
    maxDiffPixels: 100
  });
});
```

[Source: Sprint Change Proposal A, Section 11 - Testing Requirements]

---

## Definition of Done

- [ ] Ladies-only seats display pink background (#FFC0CB)
- [ ] Dark pink border (2px solid #FF69B4) applied
- [ ] Female symbol ♀ displays in top-right corner
- [ ] Symbol color deep pink (#FF1493)
- [ ] Styling works for available ladies-only seats
- [ ] Booked ladies-only seats show red with female symbol
- [ ] Locked ladies-only seats show gray with female symbol
- [ ] Regular seats unaffected by new styling
- [ ] Seat legend includes ladies-only example
- [ ] Component receives isLadiesOnly from API
- [ ] Null/undefined isLadiesOnly handled correctly
- [ ] Unit tests passing (95%+ coverage)
- [ ] E2E tests passing (Playwright)
- [ ] Visual regression tests passing
- [ ] No CSS conflicts with existing styles
- [ ] No console errors or warnings
- [ ] Hover effects functional
- [ ] Click handlers functional
- [ ] Design system compliance verified
- [ ] Code reviewed and approved
- [ ] Story 1.4.1 verified complete

---

## Dependencies & Blockers

### Blocked By:
- ⛔ Story 1.4.1 (Ladies-Only Seat Configuration) - MUST be complete
- ⛔ Seat availability API must return isLadiesOnly field

### Unblocks:
- ✅ Story 2.18.1 (Gender-Based Seat Selection Validation)
- ✅ Complete visual feedback loop for students

[Source: Sprint Change Proposal A, Section 8 - Phase 3]

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-14 | 1.0 | Story created from Sprint Change Proposal A | Bob (SM) |

---

**Story Status**: Draft
**Last Updated**: 2025-10-14
**Next Steps**: Review with PO, verify Story 1.4.1 complete, assign to frontend developer
